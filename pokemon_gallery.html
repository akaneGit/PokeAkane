<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokeAkane „Éù„Ç±„É¢„É≥Âõ≥Èëë - Âõ≥Èëë„Éô„Éº„Çπ</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        /* „Éò„ÉÉ„ÉÄ„Éº„Éà„ÉÉ„ÉóÔºà„Çø„Ç§„Éà„É´„Å®„ÉÅ„É£„Éº„Éà„Éú„Çø„É≥Ôºâ */
        .header-top {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        /* „ÉÅ„É£„Éº„ÉàË°®Á§∫„Éú„Çø„É≥ÔºàÂè≥‰∏ä„Å´Áµ∂ÂØæÈÖçÁΩÆÔºâ */
        .chart-buttons {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 10px;
        }

        .chart-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(45deg, #9c27b0, #673ab7);
            color: white;
            text-decoration: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            box-shadow: 0 3px 15px rgba(156, 39, 176, 0.3);
        }

        .chart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(156, 39, 176, 0.4);
            background: linear-gradient(45deg, #ab47bc, #7e57c2);
            color: white;
            text-decoration: none;
        }
        
        /* ‰∏ñ‰ª£Âàá„ÇäÊõø„Åà„Éú„Çø„É≥ */
        .generation-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .gen-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(45deg, #ff6b9d, #4facfe);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .gen-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .gen-btn.active {
            background: linear-gradient(45deg, #43e97b, #38f9d7);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 233, 123, 0.4);
        }

        /* Ê§úÁ¥¢„Ç®„É™„Ç¢ */
        .search-area {
            display: grid;
            grid-template-columns: 1fr 180px 150px 150px;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .search-box {
            padding: 12px 18px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            outline: none;
            font-size: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .search-box:focus {
            box-shadow: 0 4px 20px rgba(255, 107, 157, 0.3);
            background: white;
        }

        .filter-select {
            padding: 12px 16px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            outline: none;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-select:hover {
            background: white;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }

        /* „Çø„Ç§„Éó„Éï„Ç£„É´„Çø„ÉºÔºà„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥Ôºâ */
        .type-filter-container {
            position: relative;
        }

        .type-dropdown {
            position: relative;
        }

        .type-dropdown summary {
            padding: 12px 16px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            outline: none;
            font-size: 0.9rem;
            cursor: pointer;
            list-style: none;
            transition: all 0.3s ease;
            user-select: none;
        }

        .type-dropdown summary:hover {
            background: white;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }

        .type-dropdown summary::-webkit-details-marker {
            display: none;
        }

        .type-dropdown summary::after {
            content: '‚ñº';
            float: right;
            color: #666;
            transition: transform 0.3s ease;
        }

        .type-dropdown[open] summary::after {
            transform: rotate(180deg);
        }

        .type-checkbox-list {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 1000;
            padding: 20px;
            min-width: 250px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 5px;
        }

        .type-checkbox-list label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .type-checkbox-list label:hover {
            background: #f8f9fa;
            transform: translateX(2px);
        }

        .type-checkbox-list input[type="checkbox"] {
            accent-color: #ff6b9d;
            transform: scale(1.1);
        }

        /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
        @media (max-width: 768px) {
            .search-area {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .header-top {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .chart-buttons {
                justify-content: center;
            }
            
            .chart-btn {
                font-size: 0.7rem;
                padding: 6px 12px;
            }
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        
        .dex-button {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(145deg, #6c5ce7, #a29bfe);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 12px;
            min-width: 120px;
            text-align: center;
        }
        
        .dex-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.4);
            background: linear-gradient(145deg, #5f4bd1, #9187fc);
        }
        
        .dex-button.active {
            background: linear-gradient(145deg, #fd79a8, #fdcb6e);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(253, 121, 168, 0.4);
        }
        
        .info-panel {
            background: #e8f4fd;
            border: 2px solid #74b9ff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .pokemon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        /* 30Âåπ„Åî„Å®„ÅÆÂå∫Âàá„ÇäÁ∑ö */
        .row-separator {
            grid-column: 1 / -1;
            height: 3px;
            background: linear-gradient(90deg, transparent, #ff69b4, transparent);
            margin: 15px 0;
            width: 100%;
            border-radius: 2px;
            box-shadow: 0 2px 10px rgba(255, 105, 180, 0.5);
        }
        
        .pokemon-card {
            background: white;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 2px solid #e9ecef;
            cursor: pointer;
        }
        
        .pokemon-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            border-color: #74b9ff;
        }
        
        .pokemon-card.selected {
            border-color: #ff6b9d;
            background: linear-gradient(145deg, #fff5f8, #ffffff);
            box-shadow: 0 10px 25px rgba(255, 107, 157, 0.3);
        }
        
        /* Ë©≥Á¥∞Ë°®Á§∫„Éë„Éç„É´ */
        .detail-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 500px;
            width: 90%;
            display: none;
        }
        
        .detail-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        
        .detail-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .detail-pokemon-image {
            width: 150px;
            height: 150px;
            object-fit: contain;
            margin: 0 auto 20px;
            display: block;
        }
        
        .pokemon-image {
            width: 120px;
            height: 120px;
            object-fit: contain;
            margin-bottom: 10px;
            background: radial-gradient(circle, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 10px;
        }
        
        .pokemon-name {
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 5px;
            font-size: 16px;
        }
        
        .pokemon-number {
            color: #636e72;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .pokemon-types {
            display: flex;
            justify-content: center;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .type-badge {
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .type-icon {
            width: 16px;
            height: 16px;
            object-fit: contain;
        }
        
        /* „Çø„Ç§„ÉóÂà•„ÅÆËâ≤ */
        .type-„Éé„Éº„Éû„É´ { background: #A8A878; }
        .type-„Åª„ÅÆ„Åä { background: #F08030; }
        .type-„Åø„Åö { background: #6890F0; }
        .type-„Åß„Çì„Åç { background: #F8D030; }
        .type-„Åè„Åï { background: #78C850; }
        .type-„Åì„Åä„Çä { background: #98D8D8; }
        .type-„Åã„Åè„Å®„ÅÜ { background: #C03028; }
        .type-„Å©„Åè { background: #A040A0; }
        .type-„Åò„ÇÅ„Çì { background: #E0C068; }
        .type-„Å≤„Åì„ÅÜ { background: #A890F0; }
        .type-„Ç®„Çπ„Éë„Éº { background: #F85888; }
        .type-„ÇÄ„Åó { background: #A8B820; }
        .type-„ÅÑ„Çè { background: #B8A038; }
        .type-„Ç¥„Éº„Çπ„Éà { background: #705898; }
        .type-„Éâ„É©„Ç¥„É≥ { background: #7038F8; }
        .type-„ÅÇ„Åè { background: #705848; }
        .type-„ÅØ„Åå„Å≠ { background: #B8B8D0; }
        .type-„Éï„Çß„Ç¢„É™„Éº { background: #EE99AC; }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px;
        }
        
        .error {
            background: #ffe0e0;
            border: 2px solid #ff6b6b;
            color: #d63031;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- „Éò„ÉÉ„ÉÄ„Éº„Éà„ÉÉ„Éó -->
        <div class="header-top">
            <h1>üåü PokeAkane „Éù„Ç±„É¢„É≥Âõ≥Èëë üåü</h1>
            <div class="chart-buttons">
                <a href="type_chart.html" class="chart-btn">üìä „Çø„Ç§„ÉóÁõ∏ÊÄßË°®</a>
                <a href="nature_chart.html" class="chart-btn">üåü ÊÄßÊ†ºË°®</a>
            </div>
        </div>
        
        <!-- ‰∏ñ‰ª£Âàá„ÇäÊõø„Åà„Éú„Çø„É≥ -->
        <div class="generation-buttons">
            <button class="gen-btn" data-gen="all">ÂÖ®‰∏ñ‰ª£</button>
            <button class="gen-btn" data-gen="1">Á¨¨1‰∏ñ‰ª£</button>
            <button class="gen-btn" data-gen="2">Á¨¨2‰∏ñ‰ª£</button>
            <button class="gen-btn" data-gen="3">Á¨¨3‰∏ñ‰ª£</button>
            <button class="gen-btn" data-gen="4">Á¨¨4‰∏ñ‰ª£</button>
            <button class="gen-btn" data-gen="5">Á¨¨5‰∏ñ‰ª£</button>
            <button class="gen-btn" data-gen="6">Á¨¨6‰∏ñ‰ª£</button>
            <button class="gen-btn" data-gen="7">Á¨¨7‰∏ñ‰ª£</button>
            <button class="gen-btn" data-gen="8">Á¨¨8‰∏ñ‰ª£</button>
            <button class="gen-btn" data-gen="9">Á¨¨9‰∏ñ‰ª£</button>
        </div>
        
        <!-- Ê§úÁ¥¢„Ç®„É™„Ç¢ -->
        <div class="search-area">
            <input type="text" class="search-box" id="searchInput" placeholder="„Éù„Ç±„É¢„É≥Âêç„Åæ„Åü„ÅØÂõ≥ÈëëNo.„ÅßÊ§úÁ¥¢...">
            
            <div class="type-filter-container">
                <details class="type-dropdown">
                    <summary>„Çø„Ç§„ÉóÈÅ∏ÊäûÔºàË§áÊï∞ÂèØÔºâ</summary>
                    <div class="type-checkbox-list">
                        <label><input type="checkbox" value="„Éé„Éº„Éû„É´"> „Éé„Éº„Éû„É´</label>
                        <label><input type="checkbox" value="„Åª„ÅÆ„Åä"> „Åª„ÅÆ„Åä</label>
                        <label><input type="checkbox" value="„Åø„Åö"> „Åø„Åö</label>
                        <label><input type="checkbox" value="„Åß„Çì„Åç"> „Åß„Çì„Åç</label>
                        <label><input type="checkbox" value="„Åè„Åï"> „Åè„Åï</label>
                        <label><input type="checkbox" value="„Åì„Åä„Çä"> „Åì„Åä„Çä</label>
                        <label><input type="checkbox" value="„Åã„Åè„Å®„ÅÜ"> „Åã„Åè„Å®„ÅÜ</label>
                        <label><input type="checkbox" value="„Å©„Åè"> „Å©„Åè</label>
                        <label><input type="checkbox" value="„Åò„ÇÅ„Çì"> „Åò„ÇÅ„Çì</label>
                        <label><input type="checkbox" value="„Å≤„Åì„ÅÜ"> „Å≤„Åì„ÅÜ</label>
                        <label><input type="checkbox" value="„Ç®„Çπ„Éë„Éº"> „Ç®„Çπ„Éë„Éº</label>
                        <label><input type="checkbox" value="„ÇÄ„Åó"> „ÇÄ„Åó</label>
                        <label><input type="checkbox" value="„ÅÑ„Çè"> „ÅÑ„Çè</label>
                        <label><input type="checkbox" value="„Ç¥„Éº„Çπ„Éà"> „Ç¥„Éº„Çπ„Éà</label>
                        <label><input type="checkbox" value="„Éâ„É©„Ç¥„É≥"> „Éâ„É©„Ç¥„É≥</label>
                        <label><input type="checkbox" value="„ÅÇ„Åè"> „ÅÇ„Åè</label>
                        <label><input type="checkbox" value="„ÅØ„Åå„Å≠"> „ÅØ„Åå„Å≠</label>
                        <label><input type="checkbox" value="„Éï„Çß„Ç¢„É™„Éº"> „Éï„Çß„Ç¢„É™„Éº</label>
                    </div>
                </details>
            </div>

            <select class="filter-select" id="sortOrder">
                <option value="id">Áï™Âè∑È†Ü</option>
                <option value="stats_total">Á®ÆÊóèÂÄ§ÂêàË®àÈ†Ü</option>
                <option value="hp">HPÈ†Ü</option>
                <option value="attack">ÊîªÊíÉÈ†Ü</option>
                <option value="defense">Èò≤Âæ°È†Ü</option>
                <option value="special_attack">ÁâπÊîªÈ†Ü</option>
                <option value="special_defense">ÁâπÈò≤È†Ü</option>
                <option value="speed">Á¥†Êó©„ÅïÈ†Ü</option>
            </select>

            <select class="filter-select" id="evolutionFilter">
                <option value="">ÈÄ≤Âåñ„Éï„Ç£„É´„Çø„Éº</option>
                <option value="final">ÊúÄÁµÇÈÄ≤ÂåñÁ≥ª</option>
                <option value="middle">‰∏≠ÈñìÈÄ≤Âåñ</option>
                <option value="basic">ÈÄ≤ÂåñÂâç</option>
            </select>
        </div>
        
        <div class="controls" id="dexButtons">
            <div class="loading">Âõ≥Èëë‰∏ÄË¶ß„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>
        </div>
        
        <div class="info-panel" id="infoPanel" style="display: none;">
            <strong id="selectedDexName">Âõ≥Èëë„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</strong>
            <div id="pokemonCount"></div>
        </div>
        
        <div class="pokemon-grid" id="pokemonGrid">
            <div class="loading">Âõ≥Èëë„ÇíÈÅ∏Êäû„Åó„Å¶„Éù„Ç±„É¢„É≥„ÇíË°®Á§∫</div>
        </div>
    </div>

    <!-- Ë©≥Á¥∞Ë°®Á§∫„Éë„Éç„É´ -->
    <div class="detail-overlay" id="detailOverlay" onclick="closeDetailPanel()"></div>
    <div class="detail-panel" id="detailPanel">
        <div class="detail-close" onclick="closeDetailPanel()">&times;</div>
        <div id="detailContent">
            <!-- Ë©≥Á¥∞ÂÜÖÂÆπ„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
        </div>
    </div>

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let pokedexData = {};
        let pokemonData = {};
        let currentDex = null;
        let currentGeneration = 'all';
        
        // ÂàùÊúüÂåñ
        async function init() {
            console.log('initÈñ¢Êï∞„ÅåÂëº„Å∞„Çå„Åæ„Åó„Åü');
            try {
                console.log('Âõ≥ÈëëÊßãÈÄ†„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...');
                await loadPokedexStructure();
                console.log('„Éù„Ç±„É¢„É≥„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...');
                await loadPokemonData();
                console.log('Âõ≥Èëë„Éú„Çø„É≥„Çí‰ΩúÊàê‰∏≠...');
                createDexButtons();
                console.log('‰∏ñ‰ª£„Éú„Çø„É≥„Çí„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó‰∏≠...');
                setupGenerationButtons();
                console.log('Ê§úÁ¥¢„Éª„Éï„Ç£„É´„Çø„ÉºÊ©üËÉΩ„Çí„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó‰∏≠...');
                setupSearchAndFilters();
                
                console.log('„Éá„Éï„Ç©„É´„Éà„ÅßÂÖ®ÂõΩÂõ≥Èëë„ÇíÈÅ∏Êäû‰∏≠...');
                // „Éá„Éï„Ç©„É´„Éà„ÅßÂÖ®ÂõΩÂõ≥Èëë„ÇíÈÅ∏Êäû
                selectDex(0);
                console.log('ÂàùÊúüÂåñÂÆå‰∫Ü');
            } catch (error) {
                console.error('ÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                showError('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message);
            }
        }
        
        // Âõ≥ÈëëÊßãÈÄ†„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
        async function loadPokedexStructure() {
            try {
                const response = await fetch('data/pokedex_structure.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                pokedexData = await response.json();
                console.log('Âõ≥ÈëëÊßãÈÄ†„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü:', Object.keys(pokedexData).length, 'ÂÄã„ÅÆÂõ≥Èëë');
            } catch (error) {
                console.error('Âõ≥ÈëëÊßãÈÄ†„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                throw error;
            }
        }
        
        // „Éù„Ç±„É¢„É≥„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
        async function loadPokemonData() {
            const generations = [1, 2, 3, 4, 5, 6, 7, 8, 9];
            
            for (const gen of generations) {
                try {
                    const response = await fetch(`data/gen${gen}_pokemon.json`);
                    if (response.ok) {
                        const genData = await response.json();
                        Object.assign(pokemonData, genData);
                        console.log(`Á¨¨${gen}‰∏ñ‰ª£„ÅÆ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü:`, Object.keys(genData).length, 'Âåπ');
                    }
                } catch (error) {
                    console.warn(`Á¨¨${gen}‰∏ñ‰ª£„ÅÆ„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Å´Â§±Êïó:`, error);
                }
            }
            
            console.log('Á∑è„Éù„Ç±„É¢„É≥„Éá„Éº„Çø:', Object.keys(pokemonData).length, 'Âåπ');
        }
        
        // Âõ≥Èëë„Éú„Çø„É≥„Çí‰ΩúÊàê
        function createDexButtons() {
            const container = document.getElementById('dexButtons');
            container.innerHTML = '';
            
            // Âõ≥ÈëëID„Åß„ÇΩ„Éº„Éà
            const sortedDexes = Object.values(pokedexData).sort((a, b) => a.id - b.id);
            
            sortedDexes.forEach(dex => {
                const button = document.createElement('button');
                button.className = 'dex-button';
                button.textContent = dex.name;
                button.onclick = () => selectDex(dex.id);
                button.dataset.dexId = dex.id;
                container.appendChild(button);
            });
        }
        
        // ‰∏ñ‰ª£„Éú„Çø„É≥„Çí„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó
        function setupGenerationButtons() {
            const genButtons = document.querySelectorAll('.gen-btn');
            genButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    // „Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                    genButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // ÁèæÂú®„ÅÆ‰∏ñ‰ª£„ÇíÊõ¥Êñ∞
                    currentGeneration = btn.dataset.gen;
                    
                    // ‰∏ñ‰ª£„Éú„Çø„É≥„ÅåÊäº„Åï„Çå„Åü„ÇâÂÖ®ÂõΩÂõ≥Èëë„Å´Âàá„ÇäÊõø„Åà
                    if (currentGeneration !== 'all') {
                        selectDex(0, true); // ÂÖ®ÂõΩÂõ≥ÈëëÔºàID: 0Ôºâ„Å´Âàá„ÇäÊõø„ÅàÔºà‰∏ñ‰ª£„É™„Çª„ÉÉ„Éà„Çí„Çπ„Ç≠„ÉÉ„ÉóÔºâ
                    } else {
                        // ÂÖ®‰∏ñ‰ª£„ÅåÈÅ∏Êäû„Åï„Çå„ÅüÂ†¥Âêà„ÅØÁèæÂú®„ÅÆÂõ≥Èëë„ÇíË°®Á§∫
                        if (currentDex !== null) {
                            const dex = pokedexData[currentDex];
                            if (dex) {
                                displayPokemon(dex);
                            }
                        }
                    }
                });
            });
            
            // „Éá„Éï„Ç©„É´„Éà„ÅßÂÖ®‰∏ñ‰ª£„ÇíÈÅ∏Êäû
            document.querySelector('[data-gen="all"]').classList.add('active');
        }
        
        // Ê§úÁ¥¢„Éª„Éï„Ç£„É´„Çø„ÉºÊ©üËÉΩ„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„Çí„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó
        function setupSearchAndFilters() {
            // Ê§úÁ¥¢„Éú„ÉÉ„ÇØ„Çπ
            document.getElementById('searchInput').addEventListener('input', () => {
                if (currentDex !== null) {
                    const dex = pokedexData[currentDex];
                    if (dex) displayPokemon(dex);
                }
            });
            
            // „ÇΩ„Éº„ÉàÈ†ÜÂ§âÊõ¥
            document.getElementById('sortOrder').addEventListener('change', () => {
                if (currentDex !== null) {
                    const dex = pokedexData[currentDex];
                    if (dex) displayPokemon(dex);
                }
            });
            
            // ÈÄ≤Âåñ„Éï„Ç£„É´„Çø„Éº
            document.getElementById('evolutionFilter').addEventListener('change', () => {
                if (currentDex !== null) {
                    const dex = pokedexData[currentDex];
                    if (dex) displayPokemon(dex);
                }
            });
            
            // „Çø„Ç§„Éó„Éï„Ç£„É´„Çø„ÉºÔºà„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„ÇπÔºâ
            document.querySelectorAll('.type-checkbox-list input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    if (currentDex !== null) {
                        const dex = pokedexData[currentDex];
                        if (dex) displayPokemon(dex);
                    }
                });
            });
        }
        
        // Âõ≥Èëë„ÇíÈÅ∏Êäû
        function selectDex(dexId, skipGenerationReset = false) {
            currentDex = dexId;
            
            // Âõ≥Èëë„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.dex-button').forEach(btn => {
                btn.classList.remove('active');
            });
            const targetButton = document.querySelector(`[data-dex-id="${dexId}"]`);
            if (targetButton) {
                targetButton.classList.add('active');
            }
            
            // ‰∏ñ‰ª£„Éú„Çø„É≥„ÇíÂÖ®‰∏ñ‰ª£„Å´„É™„Çª„ÉÉ„ÉàÔºà‰∏ñ‰ª£„Éú„Çø„É≥„Åã„ÇâÂëº„Å∞„Çå„ÅüÂ†¥Âêà„ÅØ„Çπ„Ç≠„ÉÉ„ÉóÔºâ
            if (!skipGenerationReset) {
                document.querySelectorAll('.gen-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('[data-gen="all"]').classList.add('active');
                currentGeneration = 'all';
            }
            
            // Âõ≥ÈëëÊÉÖÂ†±„ÇíË°®Á§∫
            const dex = pokedexData[dexId];
            if (!dex) {
                console.error(`Âõ≥Èëë„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì: ID ${dexId}`);
                return;
            }
            
            document.getElementById('selectedDexName').textContent = dex.name;
            document.getElementById('pokemonCount').textContent = `ÁôªÈå≤„Éù„Ç±„É¢„É≥Êï∞: ${Object.keys(dex.pokemon).length}Âåπ`;
            document.getElementById('infoPanel').style.display = 'block';
            
            // „Éù„Ç±„É¢„É≥„ÇíË°®Á§∫
            displayPokemon(dex);
        }
        
        // „Éù„Ç±„É¢„É≥„ÇíË°®Á§∫
        function displayPokemon(dex) {
            const container = document.getElementById('pokemonGrid');
            container.innerHTML = '';
            
            // Ê§úÁ¥¢„Éª„Éï„Ç£„É´„Çø„Éº„ÅÆÂÄ§„ÇíÂèñÂæó
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const selectedTypes = Array.from(document.querySelectorAll('.type-checkbox-list input[type="checkbox"]:checked')).map(cb => cb.value);
            const evolutionFilter = document.getElementById('evolutionFilter').value;
            const sortOrder = document.getElementById('sortOrder').value;
            
            // Âõ≥ÈëëÁï™Âè∑È†Ü„Å´„ÇΩ„Éº„Éà
            const sortedPokemon = Object.entries(dex.pokemon).sort((a, b) => parseInt(a[0]) - parseInt(b[0]));
            
            // „Éï„Ç£„É´„Çø„É™„É≥„Ç∞Âá¶ÁêÜ
            const filteredPokemon = sortedPokemon.filter(([dexNumber, pokemonInfo]) => {
                const pokemon = pokemonData[pokemonInfo.pokemon_id];
                if (!pokemon) return false;
                
                // ‰∏ñ‰ª£„Éï„Ç£„É´„Çø„Éº
                if (currentGeneration !== 'all') {
                    const pokemonId = parseInt(pokemonInfo.pokemon_id);
                    const gen = getGenerationFromId(pokemonId);
                    if (gen.toString() !== currentGeneration) return false;
                }
                
                // Ê§úÁ¥¢„Éï„Ç£„É´„Çø„ÉºÔºà„Éù„Ç±„É¢„É≥Âêç„Åæ„Åü„ÅØÂõ≥ÈëëNo.Ôºâ
                if (searchTerm) {
                    const nameMatch = pokemon.name.toLowerCase().includes(searchTerm) || 
                                    (pokemon.name_en && pokemon.name_en.toLowerCase().includes(searchTerm));
                    const idMatch = pokemon.id.toString().includes(searchTerm);
                    const dexMatch = dexNumber.toString().includes(searchTerm);
                    const formattedId = pokemon.id.toString().padStart(3, '0');
                    const formattedIdMatch = formattedId.includes(searchTerm);
                    if (!nameMatch && !idMatch && !dexMatch && !formattedIdMatch) return false;
                }
                
                // „Çø„Ç§„Éó„Éï„Ç£„É´„Çø„ÉºÔºàË§áÊï∞ÈÅ∏ÊäûÂØæÂøúÔºâ
                if (selectedTypes.length > 0) {
                    const hasAllSelectedTypes = selectedTypes.every(type => pokemon.types.includes(type));
                    if (!hasAllSelectedTypes) return false;
                }
                
                // ÈÄ≤ÂåñÊÆµÈöé„Éï„Ç£„É´„Çø„Éº
                if (evolutionFilter && evolutionFilter !== '') {
                    const evolution = pokemon.evolution || {};
                    const hasEvolutionFrom = evolution.prev !== null && evolution.prev !== undefined && evolution.prev !== '';
                    const hasEvolutionTo = evolution.next && Array.isArray(evolution.next) && evolution.next.length > 0;
                    
                    if (evolutionFilter === 'basic') {
                        // ÈÄ≤ÂåñÂâçÔºöÈÄ≤ÂåñÂæå„Åå„ÅÇ„Çã„ÅåÈÄ≤ÂåñÂâç„Åå„Å™„ÅÑ„ÇÇ„ÅÆ
                        if (!(hasEvolutionTo && !hasEvolutionFrom)) return false;
                    } else if (evolutionFilter === 'middle') {
                        // ‰∏≠ÈñìÈÄ≤ÂåñÔºöÈÄ≤ÂåñÂâç„Å®ÈÄ≤ÂåñÂæå„ÅÆ‰∏°Êñπ„Åå„ÅÇ„Çã„ÇÇ„ÅÆ
                        if (!(hasEvolutionFrom && hasEvolutionTo)) return false;
                    } else if (evolutionFilter === 'final') {
                        // ÊúÄÁµÇÈÄ≤ÂåñÔºöÈÄ≤ÂåñÂæå„Åå„Å™„ÅÑ„ÇÇ„ÅÆÔºàÁÑ°ÈÄ≤Âåñ„Éù„Ç±„É¢„É≥„ÇÇÂê´„ÇÄÔºâ
                        if (hasEvolutionTo) return false;
                    }
                }
                
                return true;
            });
            
            // „ÇΩ„Éº„ÉàÂá¶ÁêÜ
            if (sortOrder !== 'id') {
                filteredPokemon.sort((a, b) => {
                    const pokemonA = pokemonData[a[1].pokemon_id];
                    const pokemonB = pokemonData[b[1].pokemon_id];
                    
                    if (!pokemonA || !pokemonB) return 0;
                    
                    if (sortOrder === 'stats_total') {
                        const statsA = pokemonA.stats ? Object.values(pokemonA.stats).reduce((sum, stat) => sum + stat, 0) : 0;
                        const statsB = pokemonB.stats ? Object.values(pokemonB.stats).reduce((sum, stat) => sum + stat, 0) : 0;
                        return statsB - statsA; // ÈôçÈ†Ü
                    } else if (pokemonA.stats && pokemonB.stats) {
                        const statA = pokemonA.stats[sortOrder] || 0;
                        const statB = pokemonB.stats[sortOrder] || 0;
                        return statB - statA; // ÈôçÈ†Ü
                    }
                    return 0;
                });
            }
            
            // „Éù„Ç±„É¢„É≥„Ç´„Éº„ÉâÊèèÁîª
            filteredPokemon.forEach(([dexNumber, pokemonInfo], index) => {
                // 30Âåπ„Åî„Å®„Å´Âå∫Âàá„ÇäÁ∑ö„ÇíËøΩÂä†ÔºàÊúÄÂàù„ÅØÈô§„ÅèÔºâ
                if (index > 0 && index % 30 === 0) {
                    const separator = document.createElement('div');
                    separator.className = 'row-separator';
                    container.appendChild(separator);
                }
                
                const pokemon = pokemonData[pokemonInfo.pokemon_id];
                if (!pokemon) {
                    console.warn(`„Éù„Ç±„É¢„É≥„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì: ID ${pokemonInfo.pokemon_id}`);
                    return;
                }
                
                const card = createPokemonCard(pokemon, dexNumber);
                container.appendChild(card);
            });
            
            // Ê§úÁ¥¢ÁµêÊûú„Åå0„ÅÆÂ†¥Âêà„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏
            if (filteredPokemon.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: #666; font-size: 1.2rem; padding: 40px;">Ë©≤ÂΩì„Åô„Çã„Éù„Ç±„É¢„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü</div>';
            }
            
            // Âõ≥ÈëëÊÉÖÂ†±„ÇíÊõ¥Êñ∞
            const totalCount = Object.keys(dex.pokemon).length;
            const filteredCount = filteredPokemon.length;
            let countText;
            if (searchTerm || selectedTypes.length > 0 || evolutionFilter) {
                countText = `Ë°®Á§∫‰∏≠: ${filteredCount}Âåπ`;
                if (currentGeneration !== 'all') {
                    const genFilteredCount = sortedPokemon.filter(([dexNumber, pokemonInfo]) => {
                        const pokemon = pokemonData[pokemonInfo.pokemon_id];
                        if (!pokemon) return false;
                        const pokemonId = parseInt(pokemonInfo.pokemon_id);
                        const gen = getGenerationFromId(pokemonId);
                        return gen.toString() === currentGeneration;
                    }).length;
                    countText += ` (Á¨¨${currentGeneration}‰∏ñ‰ª£: ${genFilteredCount}Âåπ‰∏≠)`;
                } else {
                    countText += ` (ÂÖ®${totalCount}Âåπ‰∏≠)`;
                }
            } else {
                countText = currentGeneration === 'all' 
                    ? `ÁôªÈå≤„Éù„Ç±„É¢„É≥Êï∞: ${totalCount}Âåπ`
                    : `ÁôªÈå≤„Éù„Ç±„É¢„É≥Êï∞: ${filteredCount}Âåπ (ÂÖ®${totalCount}Âåπ‰∏≠)`;
            }
            document.getElementById('pokemonCount').textContent = countText;
        }
        
        // „Éù„Ç±„É¢„É≥ID„Åã„Çâ‰∏ñ‰ª£„ÇíÂà§ÂÆö
        function getGenerationFromId(pokemonId) {
            if (pokemonId >= 1 && pokemonId <= 151) return 1;
            if (pokemonId >= 152 && pokemonId <= 251) return 2;
            if (pokemonId >= 252 && pokemonId <= 386) return 3;
            if (pokemonId >= 387 && pokemonId <= 493) return 4;
            if (pokemonId >= 494 && pokemonId <= 649) return 5;
            if (pokemonId >= 650 && pokemonId <= 721) return 6;
            if (pokemonId >= 722 && pokemonId <= 809) return 7;
            if (pokemonId >= 810 && pokemonId <= 905) return 8;
            if (pokemonId >= 906 && pokemonId <= 1025) return 9;
            return 1; // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ
        }
        
        // „Çø„Ç§„ÉóÂêç„ÅÆÂ§âÊèõ„Éû„ÉÉ„ÉóÔºàÊó•Êú¨Ë™û‚ÜíËã±Ë™ûÔºâ
        const typeNameMap = {
            '„Éé„Éº„Éû„É´': 'normal',
            '„Åª„ÅÆ„Åä': 'fire',
            '„Åø„Åö': 'water',
            '„Åß„Çì„Åç': 'electric',
            '„Åè„Åï': 'grass',
            '„Åì„Åä„Çä': 'ice',
            '„Åã„Åè„Å®„ÅÜ': 'fighting',
            '„Å©„Åè': 'poison',
            '„Åò„ÇÅ„Çì': 'ground',
            '„Å≤„Åì„ÅÜ': 'flying',
            '„Ç®„Çπ„Éë„Éº': 'psychic',
            '„ÇÄ„Åó': 'bug',
            '„ÅÑ„Çè': 'rock',
            '„Ç¥„Éº„Çπ„Éà': 'ghost',
            '„Éâ„É©„Ç¥„É≥': 'dragon',
            '„ÅÇ„Åè': 'dark',
            '„ÅØ„Åå„Å≠': 'steel',
            '„Éï„Çß„Ç¢„É™„Éº': 'fairy'
        };
        
        // „Éù„Ç±„É¢„É≥„Ç´„Éº„Éâ„Çí‰ΩúÊàê
        function createPokemonCard(pokemon, dexNumber) {
            const card = document.createElement('div');
            card.className = 'pokemon-card';
            
            // „Éù„Ç±„É¢„É≥ID„Çí3Ê°Å„ÅÆ0Âüã„ÇÅ„Éï„Ç©„Éº„Éû„ÉÉ„Éà„Å´Â§âÊèõ
            const formattedId = String(pokemon.id).padStart(3, '0');
            const imageUrl = `pokemon_images/normal/${formattedId}.png`;
            
            card.innerHTML = `
                <img src="${imageUrl}" alt="${pokemon.name}" class="pokemon-image" 
                     onerror="this.src='pokemon_images/normal/001.png'">
                <div class="pokemon-name">${pokemon.name}</div>
                <div class="pokemon-number">Âõ≥ÈëëNo. ${dexNumber} (ÂÖ®ÂõΩNo. ${pokemon.id})</div>
                <div class="pokemon-types">
                    ${pokemon.types.map(type => {
                        const englishType = typeNameMap[type] || type.toLowerCase();
                        return `
                            <span class="type-badge type-${type}">
                                <img src="type_images/${englishType}.png" alt="${type}" class="type-icon" 
                                     onerror="this.style.display='none'">
                                ${type}
                            </span>
                        `;
                    }).join('')}
                </div>
            `;
            
            // „ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„ÇíËøΩÂä†
            card.addEventListener('click', () => showPokemonDetail(pokemon, dexNumber));
            
            return card;
        }
        
        // „Éù„Ç±„É¢„É≥Ë©≥Á¥∞„ÇíË°®Á§∫
        function showPokemonDetail(pokemon, dexNumber) {
            const formattedId = String(pokemon.id).padStart(3, '0');
            const imageUrl = `pokemon_images/normal/${formattedId}.png`;
            
            const detailContent = document.getElementById('detailContent');
            detailContent.innerHTML = `
                <img src="${imageUrl}" alt="${pokemon.name}" class="detail-pokemon-image" 
                     onerror="this.src='pokemon_images/normal/001.png'">
                <h2>${pokemon.name} (${pokemon.name_en})</h2>
                <p><strong>Âõ≥ÈëëNo:</strong> ${dexNumber} (ÂÖ®ÂõΩNo. ${pokemon.id})</p>
                <div class="pokemon-types">
                    ${pokemon.types.map(type => {
                        const englishType = typeNameMap[type] || type.toLowerCase();
                        return `
                            <span class="type-badge type-${type}">
                                <img src="type_images/${englishType}.png" alt="${type}" class="type-icon" 
                                     onerror="this.style.display='none'">
                                ${type}
                            </span>
                        `;
                    }).join('')}
                </div>
                <div style="margin-top: 20px;">
                    <p><strong>È´ò„Åï:</strong> ${pokemon.height || '‰∏çÊòé'}</p>
                    <p><strong>Èáç„Åï:</strong> ${pokemon.weight || '‰∏çÊòé'}</p>
                    ${pokemon.abilities ? `<p><strong>ÁâπÊÄß:</strong> ${pokemon.abilities.join(', ')}</p>` : ''}
                </div>
            `;
            
            document.getElementById('detailOverlay').style.display = 'block';
            document.getElementById('detailPanel').style.display = 'block';
        }
        
        // Ë©≥Á¥∞„Éë„Éç„É´„ÇíÈñâ„Åò„Çã
        function closeDetailPanel() {
            document.getElementById('detailOverlay').style.display = 'none';
            document.getElementById('detailPanel').style.display = 'none';
        }
        
        // „Ç®„É©„ÉºË°®Á§∫
        function showError(message) {
            const container = document.getElementById('pokemonGrid');
            container.innerHTML = `<div class="error">${message}</div>`;
        }
        
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´ÂàùÊúüÂåñ
        window.addEventListener('load', () => {
            console.log('„Éö„Éº„Ç∏„ÅåË™≠„ÅøËæº„Åæ„Çå„Åæ„Åó„Åü');
            init();
        });
        
        // „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
        window.addEventListener('error', (e) => {
            console.error('„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü:', e.error);
        });
        
        // ESC„Ç≠„Éº„Åß„É¢„Éº„ÉÄ„É´„ÇÑ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÇíÈñâ„Åò„Çã
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                // Ë©≥Á¥∞„Éë„Éç„É´„ÇíÈñâ„Åò„Çã
                closeDetailPanel();
                // „Çø„Ç§„Éó„Éï„Ç£„É´„Çø„Éº„ÅÆ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÇíÈñâ„Åò„Çã
                const typeDropdown = document.querySelector('.type-dropdown[open]');
                if (typeDropdown) {
                    typeDropdown.removeAttribute('open');
                }
            }
        });
    </script>
</body>
</html>