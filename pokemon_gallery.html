<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokeAkane ãƒã‚±ãƒ¢ãƒ³å›³é‘‘ - å›³é‘‘ãƒ™ãƒ¼ã‚¹</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ãƒˆãƒƒãƒ—ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã¨ãƒãƒ£ãƒ¼ãƒˆãƒœã‚¿ãƒ³ï¼‰ */
        .header-top {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        /* ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤ºãƒœã‚¿ãƒ³ï¼ˆå³ä¸Šã«çµ¶å¯¾é…ç½®ï¼‰ */
        .chart-buttons {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 10px;
        }

        .chart-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(45deg, #9c27b0, #673ab7);
            color: white;
            text-decoration: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            box-shadow: 0 3px 15px rgba(156, 39, 176, 0.3);
        }

        .chart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(156, 39, 176, 0.4);
            background: linear-gradient(45deg, #ab47bc, #7e57c2);
            color: white;
            text-decoration: none;
        }
        
        /* ä¸–ä»£åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ */
        .generation-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .gen-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(45deg, #ff6b9d, #4facfe);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .gen-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .gen-btn.active {
            background: linear-gradient(45deg, #43e97b, #38f9d7);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 233, 123, 0.4);
        }

        /* æ¤œç´¢ã‚¨ãƒªã‚¢ */
        .search-area {
            display: grid;
            grid-template-columns: 1fr 180px 150px 150px;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .search-box {
            padding: 12px 18px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            outline: none;
            font-size: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .search-box:focus {
            box-shadow: 0 4px 20px rgba(255, 107, 157, 0.3);
            background: white;
        }

        .filter-select {
            padding: 12px 16px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            outline: none;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-select:hover {
            background: white;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }

        /* ã‚¿ã‚¤ãƒ—ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼‰ */
        .type-filter-container {
            position: relative;
        }

        .type-dropdown {
            position: relative;
        }

        .type-dropdown summary {
            padding: 12px 16px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            outline: none;
            font-size: 0.9rem;
            cursor: pointer;
            list-style: none;
            transition: all 0.3s ease;
            user-select: none;
        }

        .type-dropdown summary:hover {
            background: white;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }

        .type-dropdown summary::-webkit-details-marker {
            display: none;
        }

        .type-dropdown summary::after {
            content: 'â–¼';
            float: right;
            color: #666;
            transition: transform 0.3s ease;
        }

        .type-dropdown[open] summary::after {
            transform: rotate(180deg);
        }

        .type-checkbox-list {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 1000;
            padding: 20px;
            min-width: 250px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 5px;
        }

        .type-checkbox-list label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .type-checkbox-list label:hover {
            background: #f8f9fa;
            transform: translateX(2px);
        }

        .type-checkbox-list input[type="checkbox"] {
            accent-color: #ff6b9d;
            transform: scale(1.1);
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .search-area {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .header-top {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .chart-buttons {
                justify-content: center;
            }
            
            .chart-btn {
                font-size: 0.7rem;
                padding: 6px 12px;
            }
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        
        .dex-button {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(145deg, #6c5ce7, #a29bfe);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 12px;
            min-width: 120px;
            text-align: center;
        }
        
        .dex-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.4);
            background: linear-gradient(145deg, #5f4bd1, #9187fc);
        }
        
        .dex-button.active {
            background: linear-gradient(145deg, #fd79a8, #fdcb6e);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(253, 121, 168, 0.4);
        }
        
        /* 2æ®µéšè¡¨ç¤ºç”¨CSS */
        .dex-category {
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            background: #fff;
        }
        
        .category-header {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 1px solid #dee2e6;
        }
        
        .category-header:hover {
            background: linear-gradient(145deg, #e9ecef, #dee2e6);
        }
        
        .category-header.expanded {
            background: linear-gradient(145deg, #74b9ff, #0984e3);
            color: white;
        }
        
        .category-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            border-radius: 4px;
        }
        
        .category-name {
            flex: 1;
            font-weight: bold;
            font-size: 0.95rem;
        }
        
        .category-toggle {
            font-size: 0.8rem;
            transition: transform 0.3s ease;
        }
        
        .subcategory-container {
            padding: 10px;
            background: #f8f9fa;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .subcategory-button {
            font-size: 0.85rem;
            padding: 8px 12px;
            margin: 0;
            min-width: auto;
            flex: none;
        }
        
        .category-separator {
            margin: 20px 0 10px 0;
            padding: 8px 0;
            font-weight: bold;
            font-size: 1.1rem;
            color: #fd79a8;
            text-align: center;
            border-top: 2px solid #fd79a8;
            border-bottom: 1px solid #fd79a8;
        }
        
        .info-panel {
            background: #e8f4fd;
            border: 2px solid #74b9ff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .pokemon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        /* 30åŒ¹ã”ã¨ã®åŒºåˆ‡ã‚Šç·š */
        .row-separator {
            grid-column: 1 / -1;
            height: 3px;
            background: linear-gradient(90deg, transparent, #ff69b4, transparent);
            margin: 15px 0;
            width: 100%;
            border-radius: 2px;
            box-shadow: 0 2px 10px rgba(255, 105, 180, 0.5);
            position: relative;
        }
        
        /* ç•ªå·ç¯„å›²è¡¨ç¤º */
        .range-label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #ff6b9d, #4facfe);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(255, 107, 157, 0.3);
            white-space: nowrap;
        }
        
        .pokemon-card {
            background: white;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 2px solid #e9ecef;
            cursor: pointer;
        }
        
        .pokemon-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            border-color: #74b9ff;
        }
        
        .pokemon-card.selected {
            border-color: #ff6b9d;
            background: linear-gradient(145deg, #fff5f8, #ffffff);
            box-shadow: 0 10px 25px rgba(255, 107, 157, 0.3);
        }
        
        /* è©³ç´°è¡¨ç¤ºãƒ‘ãƒãƒ« */
        .detail-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            max-height: 90%;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            z-index: 1001;
            overflow-y: auto;
            display: none;
        }
        
        .detail-image-section {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .pokemon-image-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .image-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .image-label {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            background: linear-gradient(45deg, #f1f2f6, #ddd6fe);
            padding: 4px 12px;
            border-radius: 15px;
            text-align: center;
            min-width: 60px;
        }
        
        .detail-info-section {
            padding-left: 20px;
        }
        
        .form-buttons {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .form-button {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .form-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            background: linear-gradient(45deg, #5a6fd8 0%, #6b4190 100%);
        }
        
        .form-button.active {
            background: linear-gradient(45deg, #ff6b6b 0%, #ee5a24 100%);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
        }
        
        @media (min-width: 768px) {
            .detail-panel {
                display: flex;
                gap: 30px;
            }
            
            .detail-image-section {
                flex: 1;
                margin-bottom: 0;
            }
            
            .detail-info-section {
                flex: 1;
                padding-left: 0;
            }
        }
        
        .detail-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        
        .detail-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .detail-pokemon-image {
            width: 150px;
            height: 150px;
            object-fit: contain;
            margin: 0 auto 20px;
            display: block;
        }
        
        .pokemon-image {
            width: 120px;
            height: 120px;
            object-fit: contain;
            margin-bottom: 10px;
            background: radial-gradient(circle, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 10px;
        }
        
        .pokemon-name {
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 5px;
            font-size: 16px;
        }
        
        .pokemon-number {
            color: #636e72;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .pokemon-types {
            display: flex;
            justify-content: center;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .type-badge {
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .type-icon {
            width: 16px;
            height: 16px;
            object-fit: contain;
        }
        
        /* ã‚¿ã‚¤ãƒ—åˆ¥ã®è‰² */
        .type-ãƒãƒ¼ãƒãƒ« { background: #A8A878; }
        .type-ã»ã®ãŠ { background: #F08030; }
        .type-ã¿ãš { background: #6890F0; }
        .type-ã§ã‚“ã { background: #F8D030; }
        .type-ãã• { background: #78C850; }
        .type-ã“ãŠã‚Š { background: #98D8D8; }
        .type-ã‹ãã¨ã† { background: #C03028; }
        .type-ã©ã { background: #A040A0; }
        .type-ã˜ã‚ã‚“ { background: #E0C068; }
        .type-ã²ã“ã† { background: #A890F0; }
        .type-ã‚¨ã‚¹ãƒ‘ãƒ¼ { background: #F85888; }
        .type-ã‚€ã— { background: #A8B820; }
        .type-ã„ã‚ { background: #B8A038; }
        .type-ã‚´ãƒ¼ã‚¹ãƒˆ { background: #705898; }
        .type-ãƒ‰ãƒ©ã‚´ãƒ³ { background: #7038F8; }
        .type-ã‚ã { background: #705848; }
        .type-ã¯ãŒã­ { background: #B8B8D0; }
        .type-ãƒ•ã‚§ã‚¢ãƒªãƒ¼ { background: #EE99AC; }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px;
        }
        
        .error {
            background: #ffe0e0;
            border: 2px solid #ff6b6b;
            color: #d63031;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ãƒˆãƒƒãƒ— -->
        <div class="header-top">
            <h1>ğŸŒŸ PokeAkane ãƒã‚±ãƒ¢ãƒ³å›³é‘‘ ğŸŒŸ</h1>
            <div class="chart-buttons">
                <a href="type_chart.html" class="chart-btn">ğŸ“Š ã‚¿ã‚¤ãƒ—ç›¸æ€§è¡¨</a>
                <a href="nature_chart.html" class="chart-btn">ğŸŒŸ æ€§æ ¼è¡¨</a>
            </div>
        </div>
        
        <!-- ä¸–ä»£åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ -->
        <div class="generation-buttons">
            <button class="gen-btn" data-gen="all">å…¨ä¸–ä»£</button>
            <button class="gen-btn" data-gen="1">ç¬¬1ä¸–ä»£</button>
            <button class="gen-btn" data-gen="2">ç¬¬2ä¸–ä»£</button>
            <button class="gen-btn" data-gen="3">ç¬¬3ä¸–ä»£</button>
            <button class="gen-btn" data-gen="4">ç¬¬4ä¸–ä»£</button>
            <button class="gen-btn" data-gen="5">ç¬¬5ä¸–ä»£</button>
            <button class="gen-btn" data-gen="6">ç¬¬6ä¸–ä»£</button>
            <button class="gen-btn" data-gen="7">ç¬¬7ä¸–ä»£</button>
            <button class="gen-btn" data-gen="8">ç¬¬8ä¸–ä»£</button>
            <button class="gen-btn" data-gen="9">ç¬¬9ä¸–ä»£</button>
        </div>
        
        <!-- æ¤œç´¢ã‚¨ãƒªã‚¢ -->
        <div class="search-area">
            <input type="text" class="search-box" id="searchInput" placeholder="ãƒã‚±ãƒ¢ãƒ³åã¾ãŸã¯å›³é‘‘No.ã§æ¤œç´¢...">
            
            <div class="type-filter-container">
                <details class="type-dropdown">
                    <summary>ã‚¿ã‚¤ãƒ—é¸æŠï¼ˆè¤‡æ•°å¯ï¼‰</summary>
                    <div class="type-checkbox-list">
                        <label><input type="checkbox" value="ãƒãƒ¼ãƒãƒ«"> ãƒãƒ¼ãƒãƒ«</label>
                        <label><input type="checkbox" value="ã»ã®ãŠ"> ã»ã®ãŠ</label>
                        <label><input type="checkbox" value="ã¿ãš"> ã¿ãš</label>
                        <label><input type="checkbox" value="ã§ã‚“ã"> ã§ã‚“ã</label>
                        <label><input type="checkbox" value="ãã•"> ãã•</label>
                        <label><input type="checkbox" value="ã“ãŠã‚Š"> ã“ãŠã‚Š</label>
                        <label><input type="checkbox" value="ã‹ãã¨ã†"> ã‹ãã¨ã†</label>
                        <label><input type="checkbox" value="ã©ã"> ã©ã</label>
                        <label><input type="checkbox" value="ã˜ã‚ã‚“"> ã˜ã‚ã‚“</label>
                        <label><input type="checkbox" value="ã²ã“ã†"> ã²ã“ã†</label>
                        <label><input type="checkbox" value="ã‚¨ã‚¹ãƒ‘ãƒ¼"> ã‚¨ã‚¹ãƒ‘ãƒ¼</label>
                        <label><input type="checkbox" value="ã‚€ã—"> ã‚€ã—</label>
                        <label><input type="checkbox" value="ã„ã‚"> ã„ã‚</label>
                        <label><input type="checkbox" value="ã‚´ãƒ¼ã‚¹ãƒˆ"> ã‚´ãƒ¼ã‚¹ãƒˆ</label>
                        <label><input type="checkbox" value="ãƒ‰ãƒ©ã‚´ãƒ³"> ãƒ‰ãƒ©ã‚´ãƒ³</label>
                        <label><input type="checkbox" value="ã‚ã"> ã‚ã</label>
                        <label><input type="checkbox" value="ã¯ãŒã­"> ã¯ãŒã­</label>
                        <label><input type="checkbox" value="ãƒ•ã‚§ã‚¢ãƒªãƒ¼"> ãƒ•ã‚§ã‚¢ãƒªãƒ¼</label>
                    </div>
                </details>
            </div>

            <select class="filter-select" id="sortOrder">
                <option value="id">ç•ªå·é †</option>
                <option value="stats_total">ç¨®æ—å€¤åˆè¨ˆé †</option>
                <option value="hp">HPé †</option>
                <option value="attack">æ”»æ’ƒé †</option>
                <option value="defense">é˜²å¾¡é †</option>
                <option value="special_attack">ç‰¹æ”»é †</option>
                <option value="special_defense">ç‰¹é˜²é †</option>
                <option value="speed">ç´ æ—©ã•é †</option>
            </select>

            <select class="filter-select" id="evolutionFilter">
                <option value="">é€²åŒ–ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</option>
                <option value="final">æœ€çµ‚é€²åŒ–ç³»</option>
                <option value="middle">ä¸­é–“é€²åŒ–</option>
                <option value="basic">é€²åŒ–å‰</option>
            </select>
        </div>
        
        <div class="controls" id="dexButtons">
            <div class="loading">å›³é‘‘ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>
        
        <div class="info-panel" id="infoPanel" style="display: none;">
            <strong id="selectedDexName">å›³é‘‘ã‚’é¸æŠã—ã¦ãã ã•ã„</strong>
            <div id="pokemonCount"></div>
        </div>
        
        <div class="pokemon-grid" id="pokemonGrid">
            <div class="loading">å›³é‘‘ã‚’é¸æŠã—ã¦ãƒã‚±ãƒ¢ãƒ³ã‚’è¡¨ç¤º</div>
        </div>
    </div>

    <!-- è©³ç´°è¡¨ç¤ºãƒ‘ãƒãƒ« -->
    <div class="detail-overlay" id="detailOverlay" onclick="closeDetailPanel()"></div>
    <div class="detail-panel" id="detailPanel">
        <div class="detail-close" onclick="closeDetailPanel()">&times;</div>
        <div id="detailContent">
            <!-- è©³ç´°å†…å®¹ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let pokedexData = {};
        let pokemonData = {};
        let currentDex = null;
        let currentGeneration = 'all';
        
        // åˆæœŸåŒ–
        async function init() {
            console.log('inité–¢æ•°ãŒå‘¼ã°ã‚Œã¾ã—ãŸ');
            try {
                console.log('å›³é‘‘ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’èª­ã¿è¾¼ã¿ä¸­...');
                await loadPokedexIndex();
                console.log('ãƒã‚±ãƒ¢ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...');
                await loadPokemonData();
                console.log('å›³é‘‘ãƒœã‚¿ãƒ³ã‚’ä½œæˆä¸­...');
                createDexButtons();
                console.log('ä¸–ä»£ãƒœã‚¿ãƒ³ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­...');
                setupGenerationButtons();
                console.log('æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­...');
                setupSearchAndFilters();
                
                console.log('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å…¨å›½å›³é‘‘ã‚’é¸æŠä¸­...');
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å…¨å›½å›³é‘‘ã‚’é¸æŠ
                await selectDex(0);
                console.log('åˆæœŸåŒ–å®Œäº†');
            } catch (error) {
                console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                showError('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }
        
        // å›³é‘‘æ§‹é€ ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        async function loadPokedexIndex() {
            try {
                const response = await fetch('data/pokedex_index.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                pokedexData = await response.json();
                console.log('å›³é‘‘ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ:', Object.keys(pokedexData).length, 'å€‹ã®å›³é‘‘');
                console.log('åˆ©ç”¨å¯èƒ½ãªå›³é‘‘ID:', Object.keys(pokedexData).sort((a, b) => parseInt(a) - parseInt(b)));
            } catch (error) {
                console.error('å›³é‘‘ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                throw error;
            }
        }
        
        // ãƒã‚±ãƒ¢ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        async function loadPokemonData() {
            const generations = [1, 2, 3, 4, 5, 6, 7, 8, 9];
            
            for (const gen of generations) {
                try {
                    const response = await fetch(`data/gen${gen}_pokemon.json`);
                    if (response.ok) {
                        const genData = await response.json();
                        Object.assign(pokemonData, genData);
                        console.log(`ç¬¬${gen}ä¸–ä»£ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ:`, Object.keys(genData).length, 'åŒ¹');
                    }
                } catch (error) {
                    console.warn(`ç¬¬${gen}ä¸–ä»£ã®ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã«å¤±æ•—:`, error);
                }
            }
            
            console.log('ç·ãƒã‚±ãƒ¢ãƒ³ãƒ‡ãƒ¼ã‚¿:', Object.keys(pokemonData).length, 'åŒ¹');
        }
        
        // å›³é‘‘ãƒœã‚¿ãƒ³ã‚’ä½œæˆï¼ˆ2æ®µéšè¡¨ç¤ºï¼‰
        async function createDexButtons() {
            const container = document.getElementById('dexButtons');
            container.innerHTML = '';
            
            try {
                // æ–°ã—ã„éšå±¤ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
                const response = await fetch('data/pokedex_hierarchy.json');
                const hierarchyData = await response.json();
                
                // é€šå¸¸ã‚«ãƒ†ã‚´ãƒªã‚’ä½œæˆ
                hierarchyData.categories.forEach(category => {
                    createCategorySection(container, category);
                });
                
                // ç‰¹åˆ¥ã‚«ãƒ†ã‚´ãƒªã‚’ä½œæˆ
                if (hierarchyData.special_categories) {
                    hierarchyData.special_categories.forEach(category => {
                        createCategorySection(container, category);
                    });
                }
                
            } catch (error) {
                console.error('éšå±¤ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šå¤ã„æ–¹å¼
                createOldDexButtons();
            }
        }
        
        // ã‚«ãƒ†ã‚´ãƒªã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
        function createCategorySection(container, category) {
            const categoryDiv = document.createElement('div');
            categoryDiv.className = 'dex-category';
            
            // ã‚«ãƒ†ã‚´ãƒªãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆã‚¯ãƒªãƒƒã‚¯å¯èƒ½ï¼‰
            const header = document.createElement('div');
            header.className = 'category-header';
            header.innerHTML = `
                <img src="${category.icon}" alt="${category.name}" class="category-icon" onerror="this.style.display='none'">
                <span class="category-name">${category.name}</span>
                <span class="category-toggle">â–¼</span>
            `;
            
            // ã‚µãƒ–ã‚«ãƒ†ã‚´ãƒªã‚³ãƒ³ãƒ†ãƒŠ
            const subContainer = document.createElement('div');
            subContainer.className = 'subcategory-container';
            subContainer.style.display = 'none'; // åˆæœŸã¯éè¡¨ç¤º
            
            // ã‚µãƒ–ã‚«ãƒ†ã‚´ãƒªãƒœã‚¿ãƒ³ã‚’ä½œæˆ
            category.subcategories.forEach(sub => {
                const button = document.createElement('button');
                button.className = 'dex-button subcategory-button';
                button.textContent = sub.short_name || sub.name;
                button.title = sub.name; // ãƒ•ãƒ«ãƒãƒ¼ãƒ ã‚’ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã§è¡¨ç¤º
                button.onclick = () => selectDex(sub.pokedex_id);
                button.dataset.dexId = sub.pokedex_id;
                subContainer.appendChild(button);
            });
            
            // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¯ãƒªãƒƒã‚¯ã§ãƒˆã‚°ãƒ«
            header.onclick = () => {
                const isVisible = subContainer.style.display !== 'none';
                subContainer.style.display = isVisible ? 'none' : 'block';
                header.querySelector('.category-toggle').textContent = isVisible ? 'â–¼' : 'â–²';
                header.classList.toggle('expanded', !isVisible);
            };
            
            categoryDiv.appendChild(header);
            categoryDiv.appendChild(subContainer);
            container.appendChild(categoryDiv);
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šå¤ã„å›³é‘‘ãƒœã‚¿ãƒ³ä½œæˆ
        function createOldDexButtons() {
            const container = document.getElementById('dexButtons');
            container.innerHTML = '';
            
            // å›³é‘‘IDã§ã‚½ãƒ¼ãƒˆ
            const sortedDexes = Object.values(pokedexData).sort((a, b) => a.id - b.id);
            
            sortedDexes.forEach(dex => {
                const button = document.createElement('button');
                button.className = 'dex-button';
                button.textContent = dex.name;
                button.onclick = () => selectDex(dex.id);
                button.dataset.dexId = dex.id;
                container.appendChild(button);
            });
        }
        
        // ä¸–ä»£ãƒœã‚¿ãƒ³ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        function setupGenerationButtons() {
            const genButtons = document.querySelectorAll('.gen-btn');
            genButtons.forEach(btn => {
                btn.addEventListener('click', async () => {
                    // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
                    genButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // ç¾åœ¨ã®ä¸–ä»£ã‚’æ›´æ–°
                    currentGeneration = btn.dataset.gen;
                    
                    // ä¸–ä»£ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‚‰å…¨å›½å›³é‘‘ã«åˆ‡ã‚Šæ›¿ãˆ
                    if (currentGeneration !== 'all') {
                        await selectDex(0, true); // å…¨å›½å›³é‘‘ï¼ˆID: 0ï¼‰ã«åˆ‡ã‚Šæ›¿ãˆï¼ˆä¸–ä»£ãƒªã‚»ãƒƒãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼‰
                    } else {
                        // å…¨ä¸–ä»£ãŒé¸æŠã•ã‚ŒãŸå ´åˆã¯ç¾åœ¨ã®å›³é‘‘ã‚’è¡¨ç¤º
                        if (currentDex !== null) {
                            const dex = pokedexData[currentDex];
                            if (dex) {
                                displayPokemon(dex);
                            }
                        }
                    }
                });
            });
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å…¨ä¸–ä»£ã‚’é¸æŠ
            document.querySelector('[data-gen="all"]').classList.add('active');
        }
        
        // æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        function setupSearchAndFilters() {
            // æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹
            document.getElementById('searchInput').addEventListener('input', () => {
                if (currentDex !== null) {
                    const dex = pokedexData[currentDex];
                    if (dex) displayPokemon(dex);
                }
            });
            
            // ã‚½ãƒ¼ãƒˆé †å¤‰æ›´
            document.getElementById('sortOrder').addEventListener('change', () => {
                if (currentDex !== null) {
                    const dex = pokedexData[currentDex];
                    if (dex) displayPokemon(dex);
                }
            });
            
            // é€²åŒ–ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
            document.getElementById('evolutionFilter').addEventListener('change', () => {
                if (currentDex !== null) {
                    const dex = pokedexData[currentDex];
                    if (dex) displayPokemon(dex);
                }
            });
            
            // ã‚¿ã‚¤ãƒ—ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼‰
            document.querySelectorAll('.type-checkbox-list input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    if (currentDex !== null) {
                        const dex = pokedexData[currentDex];
                        if (dex) displayPokemon(dex);
                    }
                });
            });
        }
        
        // å›³é‘‘ã‚’é¸æŠ
        async function selectDex(dexId, skipGenerationReset = false) {
            currentDex = dexId;
            
            // å›³é‘‘ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.dex-button').forEach(btn => {
                btn.classList.remove('active');
            });
            const targetButton = document.querySelector(`[data-dex-id="${dexId}"]`);
            if (targetButton) {
                targetButton.classList.add('active');
            }
            
            // ä¸–ä»£ãƒœã‚¿ãƒ³ã‚’å…¨ä¸–ä»£ã«ãƒªã‚»ãƒƒãƒˆï¼ˆä¸–ä»£ãƒœã‚¿ãƒ³ã‹ã‚‰å‘¼ã°ã‚ŒãŸå ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰
            if (!skipGenerationReset) {
                document.querySelectorAll('.gen-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('[data-gen="all"]').classList.add('active');
                currentGeneration = 'all';
            }
            
            // å›³é‘‘æƒ…å ±ã‚’è¡¨ç¤º
            // å€‹åˆ¥å›³é‘‘ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€æ–¹å¼ã«å¤‰æ›´
            let dex = null;
            try {
                const resp = await fetch(`data/pokedex_structures/${dexId}.json`);
                if (!resp.ok) {
                    throw new Error(`å›³é‘‘ ${dexId} ã®èª­ã¿è¾¼ã¿å¤±æ•—: HTTP ${resp.status}`);
                }
                dex = await resp.json();
            } catch (e) {
                console.error(e);
                // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ã¿ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ä¸­æ­¢
                return;
            }
            
            document.getElementById('selectedDexName').textContent = dex.name;
            document.getElementById('pokemonCount').textContent = `ç™»éŒ²ãƒã‚±ãƒ¢ãƒ³æ•°: ${Object.keys(dex.pokemon).length}åŒ¹`;
            document.getElementById('infoPanel').style.display = 'block';
            
            // ãƒã‚±ãƒ¢ãƒ³ã‚’è¡¨ç¤º
            displayPokemon(dex);
        }
        
        // ãƒã‚±ãƒ¢ãƒ³ã‚’è¡¨ç¤º
        function displayPokemon(dex) {
            const container = document.getElementById('pokemonGrid');
            container.innerHTML = '';
            
            // æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®å€¤ã‚’å–å¾—
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const selectedTypes = Array.from(document.querySelectorAll('.type-checkbox-list input[type="checkbox"]:checked')).map(cb => cb.value);
            const evolutionFilter = document.getElementById('evolutionFilter').value;
            const sortOrder = document.getElementById('sortOrder').value;
            
            // å›³é‘‘ç•ªå·é †ã«ã‚½ãƒ¼ãƒˆ
            const sortedPokemon = Object.entries(dex.pokemon).sort((a, b) => parseInt(a[0]) - parseInt(b[0]));
            
            // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‡¦ç†
            const filteredPokemon = sortedPokemon.filter(([dexNumber, pokemonInfo]) => {
                const pokemon = pokemonData[pokemonInfo.pokemon_id];
                if (!pokemon) return false;
                
                // ä¸–ä»£ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                if (currentGeneration !== 'all') {
                    const pokemonId = parseInt(pokemonInfo.pokemon_id);
                    const gen = getGenerationFromId(pokemonId);
                    if (gen.toString() !== currentGeneration) return false;
                }
                
                // æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆãƒã‚±ãƒ¢ãƒ³åã¾ãŸã¯å›³é‘‘No.ï¼‰
                if (searchTerm) {
                    const nameMatch = pokemon.name.toLowerCase().includes(searchTerm) || 
                                    (pokemon.name_en && pokemon.name_en.toLowerCase().includes(searchTerm));
                    const idMatch = pokemon.id.toString().includes(searchTerm);
                    const dexMatch = dexNumber.toString().includes(searchTerm);
                    const formattedId = pokemon.id.toString().padStart(3, '0');
                    const formattedIdMatch = formattedId.includes(searchTerm);
                    if (!nameMatch && !idMatch && !dexMatch && !formattedIdMatch) return false;
                }
                
                // ã‚¿ã‚¤ãƒ—ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆè¤‡æ•°é¸æŠå¯¾å¿œï¼‰
                if (selectedTypes.length > 0) {
                    const hasAllSelectedTypes = selectedTypes.every(type => pokemon.types.includes(type));
                    if (!hasAllSelectedTypes) return false;
                }
                
                // é€²åŒ–æ®µéšãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                if (evolutionFilter && evolutionFilter !== '') {
                    const evolution = pokemon.evolution || {};
                    const hasEvolutionFrom = evolution.prev !== null && evolution.prev !== undefined && evolution.prev !== '';
                    const hasEvolutionTo = evolution.next && Array.isArray(evolution.next) && evolution.next.length > 0;
                    
                    if (evolutionFilter === 'basic') {
                        // é€²åŒ–å‰ï¼šé€²åŒ–å¾ŒãŒã‚ã‚‹ãŒé€²åŒ–å‰ãŒãªã„ã‚‚ã®
                        if (!(hasEvolutionTo && !hasEvolutionFrom)) return false;
                    } else if (evolutionFilter === 'middle') {
                        // ä¸­é–“é€²åŒ–ï¼šé€²åŒ–å‰ã¨é€²åŒ–å¾Œã®ä¸¡æ–¹ãŒã‚ã‚‹ã‚‚ã®
                        if (!(hasEvolutionFrom && hasEvolutionTo)) return false;
                    } else if (evolutionFilter === 'final') {
                        // æœ€çµ‚é€²åŒ–ï¼šé€²åŒ–å¾ŒãŒãªã„ã‚‚ã®ï¼ˆç„¡é€²åŒ–ãƒã‚±ãƒ¢ãƒ³ã‚‚å«ã‚€ï¼‰
                        if (hasEvolutionTo) return false;
                    }
                }
                
                return true;
            });
            
            // ã‚½ãƒ¼ãƒˆå‡¦ç†
            if (sortOrder !== 'id') {
                filteredPokemon.sort((a, b) => {
                    const pokemonA = pokemonData[a[1].pokemon_id];
                    const pokemonB = pokemonData[b[1].pokemon_id];
                    
                    if (!pokemonA || !pokemonB) return 0;
                    
                    if (sortOrder === 'stats_total') {
                        const statsA = pokemonA.stats ? Object.values(pokemonA.stats).reduce((sum, stat) => sum + stat, 0) : 0;
                        const statsB = pokemonB.stats ? Object.values(pokemonB.stats).reduce((sum, stat) => sum + stat, 0) : 0;
                        return statsB - statsA; // é™é †
                    } else if (pokemonA.stats && pokemonB.stats) {
                        const statA = pokemonA.stats[sortOrder] || 0;
                        const statB = pokemonB.stats[sortOrder] || 0;
                        return statB - statA; // é™é †
                    }
                    return 0;
                });
            }
            
            // ãƒã‚±ãƒ¢ãƒ³ã‚«ãƒ¼ãƒ‰æç”»
            filteredPokemon.forEach(([dexNumber, pokemonInfo], index) => {
                const pokemon = pokemonData[pokemonInfo.pokemon_id];
                if (!pokemon) {
                    console.warn(`ãƒã‚±ãƒ¢ãƒ³ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ID ${pokemonInfo.pokemon_id}`);
                    return;
                }
                
                // ç•ªå·é †ã®å ´åˆã®ã¿åŒºåˆ‡ã‚Šç·šã‚’è¡¨ç¤º
                if (sortOrder === 'id') {
                    // æœ€åˆï¼ˆ0åŒ¹ç›®ï¼‰ã¨30åŒ¹ã”ã¨ã«åŒºåˆ‡ã‚Šç·šã‚’è¿½åŠ 
                    if (index === 0 || index % 30 === 0) {
                        const separator = document.createElement('div');
                        separator.className = 'row-separator';
                        
                        // ç•ªå·ç¯„å›²ãƒ©ãƒ™ãƒ«ã‚’ä½œæˆ
                        const rangeLabel = document.createElement('div');
                        rangeLabel.className = 'range-label';
                        
                        // ç¯„å›²ã‚’è¨ˆç®—ï¼ˆå›³é‘‘ç•ªå·ã§è¡¨ç¤ºï¼‰
                        const startIndex = index;
                        const endIndex = Math.min(index + 29, filteredPokemon.length - 1);
                        const startDexNumber = filteredPokemon[startIndex][0];
                        const endDexNumber = filteredPokemon[endIndex][0];
                        
                        if (startDexNumber && endDexNumber) {
                            const startNum = startDexNumber.toString().padStart(3, '0');
                            const endNum = endDexNumber.toString().padStart(3, '0');
                            rangeLabel.textContent = `No.${startNum}ã€œ${endNum}`;
                        }
                        
                        separator.appendChild(rangeLabel);
                        container.appendChild(separator);
                    }
                }
                
                const card = createPokemonCard(pokemon, dexNumber);
                container.appendChild(card);
            });
            
            // æ¤œç´¢çµæœãŒ0ã®å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            if (filteredPokemon.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: #666; font-size: 1.2rem; padding: 40px;">è©²å½“ã™ã‚‹ãƒã‚±ãƒ¢ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</div>';
            }
            
            // å›³é‘‘æƒ…å ±ã‚’æ›´æ–°
            const totalCount = Object.keys(dex.pokemon).length;
            const filteredCount = filteredPokemon.length;
            let countText;
            if (searchTerm || selectedTypes.length > 0 || evolutionFilter) {
                countText = `è¡¨ç¤ºä¸­: ${filteredCount}åŒ¹`;
                if (currentGeneration !== 'all') {
                    const genFilteredCount = sortedPokemon.filter(([dexNumber, pokemonInfo]) => {
                        const pokemon = pokemonData[pokemonInfo.pokemon_id];
                        if (!pokemon) return false;
                        const pokemonId = parseInt(pokemonInfo.pokemon_id);
                        const gen = getGenerationFromId(pokemonId);
                        return gen.toString() === currentGeneration;
                    }).length;
                    countText += ` (ç¬¬${currentGeneration}ä¸–ä»£: ${genFilteredCount}åŒ¹ä¸­)`;
                } else {
                    countText += ` (å…¨${totalCount}åŒ¹ä¸­)`;
                }
            } else {
                countText = currentGeneration === 'all' 
                    ? `ç™»éŒ²ãƒã‚±ãƒ¢ãƒ³æ•°: ${totalCount}åŒ¹`
                    : `ç™»éŒ²ãƒã‚±ãƒ¢ãƒ³æ•°: ${filteredCount}åŒ¹ (å…¨${totalCount}åŒ¹ä¸­)`;
            }
            document.getElementById('pokemonCount').textContent = countText;
        }
        
        // ãƒã‚±ãƒ¢ãƒ³IDã‹ã‚‰ä¸–ä»£ã‚’åˆ¤å®š
        function getGenerationFromId(pokemonId) {
            if (pokemonId >= 1 && pokemonId <= 151) return 1;
            if (pokemonId >= 152 && pokemonId <= 251) return 2;
            if (pokemonId >= 252 && pokemonId <= 386) return 3;
            if (pokemonId >= 387 && pokemonId <= 493) return 4;
            if (pokemonId >= 494 && pokemonId <= 649) return 5;
            if (pokemonId >= 650 && pokemonId <= 721) return 6;
            if (pokemonId >= 722 && pokemonId <= 809) return 7;
            if (pokemonId >= 810 && pokemonId <= 905) return 8;
            if (pokemonId >= 906 && pokemonId <= 1025) return 9;
            return 1; // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        }
        
        // ã‚¿ã‚¤ãƒ—åã®å¤‰æ›ãƒãƒƒãƒ—ï¼ˆæ—¥æœ¬èªâ†’è‹±èªï¼‰
        const typeNameMap = {
            'ãƒãƒ¼ãƒãƒ«': 'normal',
            'ã»ã®ãŠ': 'fire',
            'ã¿ãš': 'water',
            'ã§ã‚“ã': 'electric',
            'ãã•': 'grass',
            'ã“ãŠã‚Š': 'ice',
            'ã‹ãã¨ã†': 'fighting',
            'ã©ã': 'poison',
            'ã˜ã‚ã‚“': 'ground',
            'ã²ã“ã†': 'flying',
            'ã‚¨ã‚¹ãƒ‘ãƒ¼': 'psychic',
            'ã‚€ã—': 'bug',
            'ã„ã‚': 'rock',
            'ã‚´ãƒ¼ã‚¹ãƒˆ': 'ghost',
            'ãƒ‰ãƒ©ã‚´ãƒ³': 'dragon',
            'ã‚ã': 'dark',
            'ã¯ãŒã­': 'steel',
            'ãƒ•ã‚§ã‚¢ãƒªãƒ¼': 'fairy'
        };
        
        // ãƒã‚±ãƒ¢ãƒ³ã‚«ãƒ¼ãƒ‰ã‚’ä½œæˆ
        function createPokemonCard(pokemon, dexNumber) {
            const card = document.createElement('div');
            card.className = 'pokemon-card';
            
            // ãƒã‚±ãƒ¢ãƒ³IDã‚’3æ¡ã®0åŸ‹ã‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¤‰æ›
            const formattedId = String(pokemon.id).padStart(3, '0');
            const imageUrl = `pokemon_images/normal/${formattedId}.png`;
            
            card.innerHTML = `
                <img src="${imageUrl}" alt="${pokemon.name}" class="pokemon-image" 
                     onerror="this.src='pokemon_images/normal/001.png'">
                <div class="pokemon-name">${pokemon.name}</div>
                <div class="pokemon-number">å›³é‘‘No. ${dexNumber} (å…¨å›½No. ${pokemon.id})</div>
                <div class="pokemon-types">
                    ${pokemon.types.map(type => {
                        const englishType = typeNameMap[type] || type.toLowerCase();
                        return `
                            <span class="type-badge type-${type}">
                                <img src="type_images/${englishType}.png" alt="${type}" class="type-icon" 
                                     onerror="this.style.display='none'">
                                ${type}
                            </span>
                        `;
                    }).join('')}
                </div>
            `;
            
            // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
            card.addEventListener('click', () => showPokemonDetail(pokemon, dexNumber));
            
            return card;
        }
        
        // ãƒã‚±ãƒ¢ãƒ³ã®ãƒ•ã‚©ãƒ«ãƒ ç”»åƒã‚’å–å¾—ã™ã‚‹é–¢æ•°ï¼ˆè‰²é•ã„ãƒœã‚¿ãƒ³é™¤å¤–ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
        function getPokemonFormImages(pokemon) {
            const formattedId = String(pokemon.id).padStart(3, '0');
            const englishName = pokemon.name_en.toLowerCase().replace(/[\s.]/g, '');
            
            const forms = {
                normal: `pokemon_images/normal/${formattedId}.png`
                // è‰²é•ã„ã¯æ¨ªä¸¦ã³è¡¨ç¤ºã™ã‚‹ãŸã‚ã€è‰²é•ã„ãƒœã‚¿ãƒ³ã¯å…¨ã¦é™¤å¤–
            };
            
            // åœ°æ–¹ãƒ•ã‚©ãƒ«ãƒ ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆè‰²é•ã„ãƒœã‚¿ãƒ³ã¯é™¤å¤–ï¼‰
            const regionalForms = [
                { key: 'alola', name: 'alola' },
                { key: 'galar', name: 'galar' },
                { key: 'hisui', name: 'hisui' }
            ];
            
            regionalForms.forEach(region => {
                forms[region.key] = `pokemon_images/forms/${formattedId}_${englishName}-${region.name}.png`;
                // è‰²é•ã„ãƒœã‚¿ãƒ³ã¯é™¤å¤–: forms[`${region.key}_shiny`] = ...
            });
            
            // ãƒ¡ã‚¬é€²åŒ–ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆè‰²é•ã„ãƒœã‚¿ãƒ³ã¯é™¤å¤–ï¼‰
            const megaTypes = [
                { key: 'mega', suffix: 'mega' },
                { key: 'mega-x', suffix: 'mega-x' },
                { key: 'mega-y', suffix: 'mega-y' }
            ];
            
            megaTypes.forEach(mega => {
                forms[mega.key] = `pokemon_images/mega_evolutions/${formattedId}_${englishName}-${mega.suffix}.png`;
                // è‰²é•ã„ãƒœã‚¿ãƒ³ã¯é™¤å¤–: forms[`${mega.key}_shiny`] = ...
            });
            
            // ç‰¹æ®Šãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆè‰²é•ã„ãƒœã‚¿ãƒ³ã¯é™¤å¤–ï¼‰
            if (pokemon.id === 201) { // ã‚¢ãƒ³ãƒãƒ¼ãƒ³
                const unownForms = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', 'exclamation', 'question'];
                unownForms.forEach(form => {
                    forms[`unown_${form}`] = `pokemon_images/patterns/${formattedId}_unown-${form}.png`;
                    // è‰²é•ã„ãƒœã‚¿ãƒ³ã¯é™¤å¤–: forms[`unown_${form}_shiny`] = ...
                });
            }
            
            if (pokemon.id === 351) { // ãƒãƒ¯ãƒ«ãƒ³
                const castformForms = ['sunny', 'rainy', 'snowy'];
                castformForms.forEach(form => {
                    forms[`castform_${form}`] = `pokemon_images/patterns/${formattedId}_castform-${form}.png`;
                    // è‰²é•ã„ãƒœã‚¿ãƒ³ã¯é™¤å¤–: forms[`castform_${form}_shiny`] = ...
                });
            }
            
            if (pokemon.id === 386) { // ãƒ‡ã‚ªã‚­ã‚·ã‚¹
                const deoxysForms = ['attack', 'defense', 'speed'];
                deoxysForms.forEach(form => {
                    forms[`deoxys_${form}`] = `pokemon_images/patterns/${formattedId}_deoxys-${form}.png`;
                    // è‰²é•ã„ãƒœã‚¿ãƒ³ã¯é™¤å¤–: forms[`deoxys_${form}_shiny`] = ...
                });
            }
            
            if (pokemon.id === 479) { // ãƒ­ãƒˆãƒ 
                const rotomForms = ['heat', 'wash', 'frost', 'fan', 'mow'];
                rotomForms.forEach(form => {
                    forms[`rotom_${form}`] = `pokemon_images/patterns/${formattedId}_rotom-${form}.png`;
                    // è‰²é•ã„ãƒœã‚¿ãƒ³ã¯é™¤å¤–: forms[`rotom_${form}_shiny`] = ...
                });
            }
            
            if (pokemon.id === 666) { // ãƒ“ãƒ“ãƒ¨ãƒ³
                const vivillonForms = ['archipelago', 'continental', 'elegant', 'fancy', 'garden', 'high-plains', 'icy-snow', 'jungle', 'marine', 'meadow', 'modern', 'monsoon', 'ocean', 'pokeball', 'polar', 'river', 'sandstorm', 'savanna', 'sun', 'tundra'];
                vivillonForms.forEach(form => {
                    forms[`vivillon_${form}`] = `pokemon_images/patterns/${formattedId}_vivillon-${form}.png`;
                    // è‰²é•ã„ãƒœã‚¿ãƒ³ã¯é™¤å¤–: forms[`vivillon_${form}_shiny`] = ...
                });
            }
            
            // æ–°è¦è¿½åŠ ãƒ•ã‚©ãƒ«ãƒ 
            
            // ã‚±ãƒ³ã‚¿ãƒ­ã‚¹ï¼ˆãƒ‘ãƒ«ãƒ‡ã‚¢ï¼‰
            if (pokemon.id === 128) {
                forms['tauros_combat'] = `pokemon_images/forms/${formattedId}_tauros_combat.png`;
                forms['tauros_blaze'] = `pokemon_images/forms/${formattedId}_tauros_blaze.png`;
                forms['tauros_aqua'] = `pokemon_images/forms/${formattedId}_tauros_aqua.png`;
            }
            
            // ã‚®ãƒ©ãƒ†ã‚£ãƒŠ
            if (pokemon.id === 487) {
                forms['giratina_altered'] = `pokemon_images/patterns/${formattedId}_giratina-altered.png`;
                forms['giratina_origin'] = `pokemon_images/patterns/${formattedId}_giratina-origin.png`;
            }
            
            // ã‚·ã‚§ã‚¤ãƒŸ
            if (pokemon.id === 492) {
                forms['shaymin_land'] = `pokemon_images/patterns/${formattedId}_shaymin-land.png`;
                forms['shaymin_sky'] = `pokemon_images/patterns/${formattedId}_shaymin-sky.png`;
            }
            
            // ãƒ’ãƒ’ãƒ€ãƒ«ãƒ
            if (pokemon.id === 555) {
                forms['darmanitan_zen'] = `pokemon_images/patterns/${formattedId}_darmanitan-zen.png`;
                forms['darmanitan_galar'] = `pokemon_images/forms/${formattedId}_darmanitan-galar.png`;
                forms['darmanitan_zen_galar'] = `pokemon_images/forms/${formattedId}_darmanitan_zen_galar.png`;
            }
            
            // ãƒ¡ãƒ­ã‚¨ãƒƒã‚¿
            if (pokemon.id === 648) {
                forms['meloetta_aria'] = `pokemon_images/patterns/${formattedId}_meloetta-aria.png`;
                forms['meloetta_pirouette'] = `pokemon_images/patterns/${formattedId}_meloetta-pirouette.png`;
            }
            
            // ã‚®ãƒ«ã‚¬ãƒ«ãƒ‰
            if (pokemon.id === 681) {
                forms['aegislash_shield'] = `pokemon_images/patterns/${formattedId}_aegislash-shield.png`;
                forms['aegislash_blade'] = `pokemon_images/patterns/${formattedId}_aegislash-blade.png`;
            }
            
            // ãƒã‚±ãƒƒãƒãƒ£
            if (pokemon.id === 710) {
                forms['pumpkaboo_small'] = `pokemon_images/patterns/${formattedId}_pumpkaboo-small.png`;
                forms['pumpkaboo_average'] = `pokemon_images/patterns/${formattedId}_pumpkaboo-average.png`;
                forms['pumpkaboo_large'] = `pokemon_images/patterns/${formattedId}_pumpkaboo-large.png`;
                forms['pumpkaboo_super'] = `pokemon_images/patterns/${formattedId}_pumpkaboo-super.png`;
            }
            
            // ãƒ‘ãƒ³ãƒ—ã‚¸ãƒ³
            if (pokemon.id === 711) {
                forms['gourgeist_small'] = `pokemon_images/patterns/${formattedId}_gourgeist-small.png`;
                forms['gourgeist_average'] = `pokemon_images/patterns/${formattedId}_gourgeist-average.png`;
                forms['gourgeist_large'] = `pokemon_images/patterns/${formattedId}_gourgeist-large.png`;
                forms['gourgeist_super'] = `pokemon_images/patterns/${formattedId}_gourgeist-super.png`;
            }
            
            // ã‚¸ã‚¬ãƒ«ãƒ‡
            if (pokemon.id === 718) {
                forms['zygarde_10'] = `pokemon_images/patterns/${formattedId}_zygarde-10.png`;
                forms['zygarde_50'] = `pokemon_images/patterns/${formattedId}_zygarde-50.png`;
                forms['zygarde_complete'] = `pokemon_images/patterns/${formattedId}_zygarde-complete.png`;
            }
            
            // ã‚ªãƒ‰ãƒªãƒ‰ãƒª
            if (pokemon.id === 741) {
                forms['oricorio_baile'] = `pokemon_images/patterns/${formattedId}_oricorio-baile.png`;
                forms['oricorio_pom_pom'] = `pokemon_images/patterns/${formattedId}_oricorio-pom-pom.png`;
                forms['oricorio_pau'] = `pokemon_images/patterns/${formattedId}_oricorio-pau.png`;
                forms['oricorio_sensu'] = `pokemon_images/patterns/${formattedId}_oricorio-sensu.png`;
            }
            
            // ãƒ«ã‚¬ãƒ«ã‚¬ãƒ³
            if (pokemon.id === 745) {
                forms['lycanroc_midday'] = `pokemon_images/patterns/${formattedId}_lycanroc-midday.png`;
                forms['lycanroc_midnight'] = `pokemon_images/patterns/${formattedId}_lycanroc-midnight.png`;
                forms['lycanroc_dusk'] = `pokemon_images/patterns/${formattedId}_lycanroc-dusk.png`;
            }
            
            // ãƒã‚¯ãƒ­ã‚ºãƒ
            if (pokemon.id === 800) {
                forms['necrozma_dusk'] = `pokemon_images/patterns/${formattedId}_necrozma_dusk.png`;
                forms['necrozma_dawn'] = `pokemon_images/patterns/${formattedId}_necrozma_dawn.png`;
                forms['necrozma_ultra'] = `pokemon_images/patterns/${formattedId}_necrozma-ultra.png`;
            }
            
            // ã‚¹ãƒˆãƒªãƒ³ãƒ€ãƒ¼
            if (pokemon.id === 849) {
                forms['toxtricity_amped'] = `pokemon_images/patterns/${formattedId}_toxtricity-amped.png`;
                forms['toxtricity_low_key'] = `pokemon_images/patterns/${formattedId}_toxtricity-low-key.png`;
            }
            
            // ã‚¦ãƒ¼ãƒ©ã‚ªã‚¹
            if (pokemon.id === 892) {
                forms['urshifu_single_strike'] = `pokemon_images/patterns/${formattedId}_urshifu-single-strike.png`;
                forms['urshifu_rapid_strike'] = `pokemon_images/patterns/${formattedId}_urshifu-rapid-strike.png`;
            }
            
            // ãƒ†ãƒ©ãƒ‘ã‚´ã‚¹
            if (pokemon.id === 1024) {
                forms['terapagos_terastal'] = `pokemon_images/patterns/${formattedId}_terapagos-terastal.png`;
                forms['terapagos_stellar'] = `pokemon_images/patterns/${formattedId}_terapagos-stellar.png`;
            }
            
            // ã‚²ãƒ³ã‚·ã‚«ã‚¤ã‚­
            if (pokemon.id === 382) { // ã‚«ã‚¤ã‚ªãƒ¼ã‚¬
                forms['kyogre_primal'] = `pokemon_images/patterns/${formattedId}_kyogre-primal.png`;
            }
            
            if (pokemon.id === 383) { // ã‚°ãƒ©ãƒ¼ãƒ‰ãƒ³
                forms['groudon_primal'] = `pokemon_images/patterns/${formattedId}_groudon-primal.png`;
            }
            
            return forms;
        }
        
        // ç”»åƒã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯é–¢æ•°
        async function checkImageExists(url) {
            return new Promise(resolve => {
                const img = new Image();
                img.onload = () => resolve(true);
                img.onerror = () => resolve(false);
                img.src = url;
            });
        }
        
        // ãƒ•ã‚©ãƒ«ãƒ åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã‚’ä½œæˆ
        async function createFormButtons(pokemon, currentImageElement) {
            const forms = getPokemonFormImages(pokemon);
            const formButtonsContainer = document.getElementById('formButtons');
            formButtonsContainer.innerHTML = '';
            
            const availableForms = [];
            
            // å„ãƒ•ã‚©ãƒ«ãƒ ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
            for (const [formName, imagePath] of Object.entries(forms)) {
                const exists = await checkImageExists(imagePath);
                if (exists) {
                    availableForms.push({name: formName, path: imagePath});
                }
            }
            
            if (availableForms.length > 1) {
                availableForms.forEach(form => {
                    const button = document.createElement('button');
                    button.className = 'form-button';
                    
                    // ãƒœã‚¿ãƒ³ã®ãƒ©ãƒ™ãƒ«ã‚’æ—¥æœ¬èªã«ï¼ˆè‰²é•ã„ãƒœã‚¿ãƒ³ã¯å…¨ã¦é™¤å¤–ï¼‰
                    const formLabels = {
                        'normal': 'ãƒãƒ¼ãƒãƒ«',
                        'alola': 'ã‚¢ãƒ­ãƒ¼ãƒ©',
                        'galar': 'ã‚¬ãƒ©ãƒ«',
                        'hisui': 'ãƒ’ã‚¹ã‚¤',
                        'mega': 'ãƒ¡ã‚¬',
                        'mega-x': 'ãƒ¡ã‚¬X',
                        'mega-y': 'ãƒ¡ã‚¬Y',
                        // ã‚¢ãƒ³ãƒãƒ¼ãƒ³ãƒ•ã‚©ãƒ«ãƒ 
                        'unown_a': 'A', 'unown_b': 'B', 'unown_c': 'C', 'unown_d': 'D', 'unown_e': 'E',
                        'unown_f': 'F', 'unown_g': 'G', 'unown_h': 'H', 'unown_i': 'I', 'unown_j': 'J',
                        'unown_k': 'K', 'unown_l': 'L', 'unown_m': 'M', 'unown_n': 'N', 'unown_o': 'O',
                        'unown_p': 'P', 'unown_q': 'Q', 'unown_r': 'R', 'unown_s': 'S', 'unown_t': 'T',
                        'unown_u': 'U', 'unown_v': 'V', 'unown_w': 'W', 'unown_x': 'X', 'unown_y': 'Y', 'unown_z': 'Z',
                        'unown_exclamation': 'ï¼', 'unown_question': 'ï¼Ÿ',
                        // ãƒãƒ¯ãƒ«ãƒ³ãƒ•ã‚©ãƒ«ãƒ 
                        'castform_sunny': 'ãŸã„ã‚ˆã†ã®ã™ãŒãŸ',
                        'castform_rainy': 'ã‚ã¾ã¿ãšã®ã™ãŒãŸ',
                        'castform_snowy': 'ã‚†ããã‚‚ã®ã™ãŒãŸ',
                        // ãƒ‡ã‚ªã‚­ã‚·ã‚¹ãƒ•ã‚©ãƒ«ãƒ 
                        'deoxys_attack': 'ã‚¢ã‚¿ãƒƒã‚¯',
                        'deoxys_defense': 'ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚¹',
                        'deoxys_speed': 'ã‚¹ãƒ”ãƒ¼ãƒ‰',
                        // ãƒ­ãƒˆãƒ ãƒ•ã‚©ãƒ«ãƒ 
                        'rotom_heat': 'ãƒ’ãƒ¼ãƒˆ',
                        'rotom_wash': 'ã‚¦ã‚©ãƒƒã‚·ãƒ¥',
                        'rotom_frost': 'ãƒ•ãƒ­ã‚¹ãƒˆ',
                        'rotom_fan': 'ã‚¹ãƒ”ãƒ³',
                        'rotom_mow': 'ã‚«ãƒƒãƒˆ',
                        // ãƒ“ãƒ“ãƒ¨ãƒ³
                        'vivillon_archipelago': 'ã›ã‚“ã¨ã†', 'vivillon_continental': 'ãŸã„ã‚Šã',
                        'vivillon_elegant': 'ã¿ã‚„ã³', 'vivillon_fancy': 'ã¯ãªã‚‚ã‚ˆã†',
                        'vivillon_garden': 'ãƒ•ãƒ©ãƒ¯ãƒ¼', 'vivillon_high-plains': 'ã“ã†ã’ã‚“',
                        'vivillon_icy-snow': 'ã›ã¤ã’ã‚“', 'vivillon_jungle': 'ã‚¸ãƒ£ãƒ³ã‚°ãƒ«',
                        'vivillon_marine': 'ãƒãƒªãƒ³', 'vivillon_meadow': 'ã—ã¨ã†ãã‚“',
                        'vivillon_modern': 'ãƒ¢ãƒ€ãƒ³', 'vivillon_monsoon': 'ã‚¹ã‚³ãƒ¼ãƒ«',
                        'vivillon_ocean': 'ã‚ªãƒ¼ã‚·ãƒ£ãƒ³', 'vivillon_pokeball': 'ãƒœãƒ¼ãƒ«',
                        'vivillon_polar': 'ãƒ„ãƒ³ãƒ‰ãƒ©', 'vivillon_river': 'ãƒªãƒãƒ¼',
                        'vivillon_sandstorm': 'ã•ã‚“ã±ã¡', 'vivillon_savanna': 'ã‚µãƒãƒ³ãƒŠ',
                        'vivillon_sun': 'ãŸã„ã‚ˆã†', 'vivillon_tundra': 'ã‚†ããã«',
                        // æ–°è¿½åŠ ãƒ•ã‚©ãƒ«ãƒ 
                        'tauros_blaze': 'ãƒ–ãƒ¬ã‚¤ã‚º', 'tauros_aqua': 'ã‚¢ã‚¯ã‚¢', 'tauros_combat': 'ã‚³ãƒ³ãƒãƒƒãƒˆ',
                        'giratina_altered': 'ã‚¢ãƒŠã‚¶ãƒ¼', 'giratina_origin': 'ã‚ªãƒªã‚¸ãƒ³',
                        'shaymin_land': 'ãƒ©ãƒ³ãƒ‰', 'shaymin_sky': 'ã‚¹ã‚«ã‚¤',
                        'darmanitan_standard': 'ãƒãƒ¼ãƒãƒ«', 'darmanitan_zen': 'ãƒ€ãƒ«ãƒ',
                        'darmanitan_galar': 'ã‚¬ãƒ©ãƒ«', 'darmanitan_zen_galar': 'ã‚¬ãƒ©ãƒ«ãƒ€ãƒ«ãƒ',
                        'meloetta_aria': 'ãƒœã‚¤ã‚¹', 'meloetta_pirouette': 'ã‚¹ãƒ†ãƒƒãƒ—',
                        'aegislash_shield': 'ã‚·ãƒ¼ãƒ«ãƒ‰', 'aegislash_blade': 'ãƒ–ãƒ¬ãƒ¼ãƒ‰',
                        'pumpkaboo_small': 'å°', 'pumpkaboo_average': 'æ™®é€š',
                        'pumpkaboo_large': 'å¤§', 'pumpkaboo_super': 'ç‰¹å¤§',
                        'gourgeist_small': 'å°', 'gourgeist_average': 'æ™®é€š',
                        'gourgeist_large': 'å¤§', 'gourgeist_super': 'ç‰¹å¤§',
                        'zygarde_10': '10%', 'zygarde_50': '50%', 'zygarde_complete': 'ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆ',
                        'oricorio_baile': 'ã‚ã‚‰ã‚ã‚‰', 'oricorio_pom_pom': 'ã±ã¡ã±ã¡',
                        'oricorio_pau': 'ãµã‚‰ãµã‚‰', 'oricorio_sensu': 'ã¾ã„ã¾ã„',
                        'lycanroc_midday': 'ã¾ã²ã‚‹', 'lycanroc_midnight': 'ã¾ã‚ˆãªã‹', 'lycanroc_dusk': 'ãŸããŒã‚Œ',
                        'necrozma_dusk': 'ãŸããŒã‚Œã®ãŸã¦ãŒã¿', 'necrozma_dawn': 'ã‚ã‹ã¤ãã®ã¤ã°ã•', 'necrozma_ultra': 'ã‚¦ãƒ«ãƒˆãƒ©',
                        'toxtricity_amped': 'ãƒã‚¤', 'toxtricity_low_key': 'ãƒ­ãƒ¼',
                        'urshifu_single_strike': 'ã„ã¡ã’ã', 'urshifu_rapid_strike': 'ã‚Œã‚“ã’ã',
                        'terapagos_stellar': 'ã‚¹ãƒ†ãƒ©', 'terapagos_terastal': 'ãƒ†ãƒ©ã‚¹ã‚¿ãƒ«',
                        'kyogre_primal': 'ã‚²ãƒ³ã‚·', 'groudon_primal': 'ã‚²ãƒ³ã‚·'
                    };
                    
                    button.textContent = formLabels[form.name] || form.name;
                    
                    if (form.name === 'normal') {
                        button.classList.add('active');
                    }
                    
                    button.onclick = async () => {
                        // ãƒ•ã‚©ãƒ«ãƒ åˆ‡ã‚Šæ›¿ãˆæ™‚ã«ç”»åƒã‚³ãƒ³ãƒ†ãƒŠå…¨ä½“ã‚’æ›´æ–°
                        await updateImageContainer(pokemon, form.path, form.name);
                        document.querySelectorAll('.form-button').forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                    };
                    
                    formButtonsContainer.appendChild(button);
                });
            }
        }
        
        // ç”»åƒã‚³ãƒ³ãƒ†ãƒŠã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        async function updateImageContainer(pokemon, newFormPath, formType) {
            const formattedId = String(pokemon.id).padStart(3, '0');
            const container = document.querySelector('.pokemon-image-container');
            
            // ãƒ•ã‚©ãƒ«ãƒ ã®è‰²é•ã„ãƒ‘ã‚¹ã‚’ç”Ÿæˆ
            let shinyPath = '';
            let formLabel = '';
            
            // ãƒ•ã‚©ãƒ«ãƒ ã®ãƒ©ãƒ™ãƒ«ã‚’è¨­å®š
            const formLabels = {
                'normal': 'ãƒãƒ¼ãƒãƒ«',
                'alola': 'ã‚¢ãƒ­ãƒ¼ãƒ©',
                'galar': 'ã‚¬ãƒ©ãƒ«', 
                'hisui': 'ãƒ’ã‚¹ã‚¤',
                'mega': 'ãƒ¡ã‚¬',
                'mega-x': 'ãƒ¡ã‚¬X',
                'mega-y': 'ãƒ¡ã‚¬Y',
                // æ–°è¿½åŠ ãƒ•ã‚©ãƒ«ãƒ 
                'giratina_altered': 'ã‚¢ãƒŠã‚¶ãƒ¼', 'giratina_origin': 'ã‚ªãƒªã‚¸ãƒ³',
                'shaymin_land': 'ãƒ©ãƒ³ãƒ‰', 'shaymin_sky': 'ã‚¹ã‚«ã‚¤',
                'darmanitan_standard': 'ãƒãƒ¼ãƒãƒ«', 'darmanitan_zen': 'ãƒ€ãƒ«ãƒ',
                'darmanitan_galar': 'ã‚¬ãƒ©ãƒ«', 'darmanitan_zen_galar': 'ã‚¬ãƒ©ãƒ«ãƒ€ãƒ«ãƒ',
                'meloetta_aria': 'ãƒœã‚¤ã‚¹', 'meloetta_pirouette': 'ã‚¹ãƒ†ãƒƒãƒ—',
                'aegislash_shield': 'ã‚·ãƒ¼ãƒ«ãƒ‰', 'aegislash_blade': 'ãƒ–ãƒ¬ãƒ¼ãƒ‰',
                'pumpkaboo_small': 'å°', 'pumpkaboo_average': 'æ™®é€š',
                'pumpkaboo_large': 'å¤§', 'pumpkaboo_super': 'ç‰¹å¤§',
                'gourgeist_small': 'å°', 'gourgeist_average': 'æ™®é€š',
                'gourgeist_large': 'å¤§', 'gourgeist_super': 'ç‰¹å¤§',
                'zygarde_10': '10%', 'zygarde_50': '50%', 'zygarde_complete': 'ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆ',
                'oricorio_baile': 'ã‚ã‚‰ã‚ã‚‰', 'oricorio_pom_pom': 'ã±ã¡ã±ã¡',
                'oricorio_pau': 'ãµã‚‰ãµã‚‰', 'oricorio_sensu': 'ã¾ã„ã¾ã„',
                'lycanroc_midday': 'ã¾ã²ã‚‹', 'lycanroc_midnight': 'ã¾ã‚ˆãªã‹', 'lycanroc_dusk': 'ãŸããŒã‚Œ',
                'tauros_blaze': 'ãƒ–ãƒ¬ã‚¤ã‚º', 'tauros_aqua': 'ã‚¢ã‚¯ã‚¢', 'tauros_combat': 'ã‚³ãƒ³ãƒãƒƒãƒˆ',
                'necrozma_dusk': 'ãŸããŒã‚Œã®ãŸã¦ãŒã¿', 'necrozma_dawn': 'ã‚ã‹ã¤ãã®ã¤ã°ã•', 'necrozma_ultra': 'ã‚¦ãƒ«ãƒˆãƒ©',
                'toxtricity_amped': 'ãƒã‚¤', 'toxtricity_low_key': 'ãƒ­ãƒ¼',
                'urshifu_single_strike': 'ã„ã¡ã’ã', 'urshifu_rapid_strike': 'ã‚Œã‚“ã’ã',
                'terapagos_stellar': 'ã‚¹ãƒ†ãƒ©', 'terapagos_terastal': 'ãƒ†ãƒ©ã‚¹ã‚¿ãƒ«',
                'kyogre_primal': 'ã‚²ãƒ³ã‚·', 'groudon_primal': 'ã‚²ãƒ³ã‚·'
            };
            
            formLabel = formLabels[formType] || formType;
            
            if (formType === 'normal') {
                shinyPath = `pokemon_images/shinies/${formattedId}_shiny.png`;
            } else {
                // ä»–ã®ãƒ•ã‚©ãƒ«ãƒ ã®è‰²é•ã„ã‚’æ¢ã™
                shinyPath = newFormPath.replace('.png', '_shiny.png');
            }
            
            // è‰²é•ã„ç”»åƒã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
            const shinyExists = shinyPath ? await checkImageExists(shinyPath) : false;
            
            container.innerHTML = `
                <div class="image-item">
                    <img src="${newFormPath}" alt="${pokemon.name} (${formLabel})" class="detail-pokemon-image" 
                         onerror="this.src='pokemon_images/normal/${formattedId}.png'">
                    <div class="image-label">${formLabel}</div>
                </div>
                ${shinyExists ? `
                    <div class="image-item">
                        <img src="${shinyPath}" alt="${pokemon.name} (${formLabel}è‰²é•ã„)" class="detail-pokemon-image" 
                             onerror="this.style.display='none'">
                        <div class="image-label">${formLabel}è‰²é•ã„</div>
                    </div>
                ` : ''}
            `;
        }
        
        // ãƒã‚±ãƒ¢ãƒ³è©³ç´°ã‚’è¡¨ç¤º
        async function showPokemonDetail(pokemon, dexNumber) {
            const formattedId = String(pokemon.id).padStart(3, '0');
            const normalImageUrl = `pokemon_images/normal/${formattedId}.png`;
            const shinyImageUrl = `pokemon_images/shinies/${formattedId}_shiny.png`;
            
            // è‰²é•ã„ç”»åƒã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
            const shinyExists = await checkImageExists(shinyImageUrl);
            
            const detailContent = document.getElementById('detailContent');
            detailContent.innerHTML = `
                <div class="detail-image-section">
                    <div class="pokemon-image-container">
                        <div class="image-item">
                            <img id="detailPokemonImage" src="${normalImageUrl}" alt="${pokemon.name}" class="detail-pokemon-image" 
                                 onerror="this.src='pokemon_images/normal/001.png'">
                            <div class="image-label">ãƒãƒ¼ãƒãƒ«</div>
                        </div>
                        ${shinyExists ? `
                            <div class="image-item">
                                <img src="${shinyImageUrl}" alt="${pokemon.name} (è‰²é•ã„)" class="detail-pokemon-image" 
                                     onerror="this.style.display='none'">
                                <div class="image-label">è‰²é•ã„</div>
                            </div>
                        ` : ''}
                    </div>
                    <div id="formButtons" class="form-buttons">
                        <!-- ãƒ•ã‚©ãƒ«ãƒ åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                    </div>
                </div>
                <div class="detail-info-section">
                    <h2>${pokemon.name} (${pokemon.name_en})</h2>
                    <p><strong>å›³é‘‘No:</strong> ${dexNumber} (å…¨å›½No. ${pokemon.id})</p>
                    <div class="pokemon-types">
                        ${pokemon.types.map(type => {
                            const englishType = typeNameMap[type] || type.toLowerCase();
                            return `
                                <span class="type-badge type-${type}">
                                    <img src="type_images/${englishType}.png" alt="${type}" class="type-icon" 
                                         onerror="this.style.display='none'">
                                    ${type}
                                </span>
                            `;
                        }).join('')}
                    </div>
                    <div style="margin-top: 20px;">
                        <p><strong>é«˜ã•:</strong> ${pokemon.height || 'ä¸æ˜'}</p>
                        <p><strong>é‡ã•:</strong> ${pokemon.weight || 'ä¸æ˜'}</p>
                        ${pokemon.abilities ? `<p><strong>ç‰¹æ€§:</strong> ${pokemon.abilities.join(', ')}</p>` : ''}
                    </div>
                </div>
            `;
            
            document.getElementById('detailOverlay').style.display = 'block';
            document.getElementById('detailPanel').style.display = 'block';
            
            // ãƒ•ã‚©ãƒ«ãƒ åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã‚’ä½œæˆï¼ˆç”»åƒèª­ã¿è¾¼ã¿å¾Œï¼‰
            const imageElement = document.getElementById('detailPokemonImage');
            imageElement.onload = () => {
                createFormButtons(pokemon, imageElement);
            };
        }
        
        // è©³ç´°ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹
        function closeDetailPanel() {
            document.getElementById('detailOverlay').style.display = 'none';
            document.getElementById('detailPanel').style.display = 'none';
        }
        
        // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
        function showError(message) {
            const container = document.getElementById('pokemonGrid');
            container.innerHTML = `<div class="error">${message}</div>`;
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        window.addEventListener('load', () => {
            console.log('ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            init();
        });
        
        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        window.addEventListener('error', (e) => {
            console.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', e.error);
        });
        
        // ESCã‚­ãƒ¼ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚„ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’é–‰ã˜ã‚‹
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                // è©³ç´°ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹
                closeDetailPanel();
                // ã‚¿ã‚¤ãƒ—ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’é–‰ã˜ã‚‹
                const typeDropdown = document.querySelector('.type-dropdown[open]');
                if (typeDropdown) {
                    typeDropdown.removeAttribute('open');
                }
            }
        });
    </script>
</body>
</html>